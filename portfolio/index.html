<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Portfolio | Uri Sh.</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Portfolio" />
<meta name="author" content="Uri Shani" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A portfolio centered site with a blog, to feature my adventures and projects in making, programming, and engineering. Built in Jekyll, to be served from Github pages." />
<meta property="og:description" content="A portfolio centered site with a blog, to feature my adventures and projects in making, programming, and engineering. Built in Jekyll, to be served from Github pages." />
<link rel="canonical" href="https://urishx.github.io/portfolio/" />
<meta property="og:url" content="https://urishx.github.io/portfolio/" />
<meta property="og:site_name" content="Uri Sh." />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Portfolio" />
<script type="application/ld+json">
{"headline":"Portfolio","description":"A portfolio centered site with a blog, to feature my adventures and projects in making, programming, and engineering. Built in Jekyll, to be served from Github pages.","@type":"WebPage","url":"https://urishx.github.io/portfolio/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://urishx.github.io/logo.png"},"name":"Uri Shani"},"author":{"@type":"Person","name":"Uri Shani"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://urishx.github.io/feed.xml" title="Uri Sh." />
<link href="https://fonts.googleapis.com/css2?family=Alef&family=Tinos&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
<link rel="icon" href="/assets/cropped-logo-1-32x32.png" sizes="32x32"/></head>
<body><div>
    <header class="site-header" style="background-image: url('/assets/img/banner.png');">
        <div class="banner">
            <div class="img-container">
                
                    <img alt="logo" src="/assets/img/logo.png"/>
                
            </div>
            <h1 class="site-title">
                <a rel="author" href="/">Uri Sh.</a>
            </h1>
            <h2>Making, Engineering, and Blogging about it too</h2>
        </div>
        <div class="wrapper"><nav class="site-nav">
                    <input class="nav-trigger" id="nav-trigger" type="checkbox"/>
                    <label for="nav-trigger">
                        <span class="menu-icon">
                            <svg height="15px" viewbox="0 0 18 15" width="18px">
                                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
                            </svg>
                        </span>
                    </label>

                    <div class="trigger">
                        <a class="page-link" href="/" >Home</a><a class="page-link" href="/about/" >About me</a><a class="page-current" href="/portfolio/"  aria-disabled="true" >Portfolio</a></div>
                </nav></div>
    </header>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        



<div class="portfolio">
    <header class="post-header">
        <h1 class="post-title">Portfolio</h1>
    </header>
    <div class="post-content">
        <p>This is a short portfolio of significant works I have done over the past few years. Clicking on the tiles will open a popup with more details about the work. Some of the tiles also have a link to code samples, 3D designs, or other relevant materials.</p>

<p>Please contact me for further details about any of the projects listed below. You can also find me on <a href="https://www.facebook.com/uri.sh.982">Facebook</a>, Twitter (<a href="https://twitter.com/UriShX">@UriShX</a>), and on <a href="https://hackaday.io/UriSh">Hackcady.io</a>. You can also email me at: urish[at]urishx[dot]com</p>

<p>The Github repo for this portfolio is: <a href="https://github.com/UriShX/Jekyll-portfolio">UriShX/Jekyll-portfolio</a>. A markdown portfolio that was the basis for starting this project lives <a href="https://github.com/UriShX/portfolio">here</a>.</p>

    </div>

    <div class="portfolio-tags">
        <a href="#portfolio-all-tags">All</a>
        
        <a href="#prototype">prototype</a>
        
        <a href="#model">model</a>
        
        <a href="#arduino">arduino</a>
        
        <a href="#control">control</a>
        
        <a href="#plastics-engineering">plastics-engineering</a>
        
        <a href="#cad">cad</a>
        
        <a href="#cae">cae</a>
        
        <a href="#injection-molding">injection-molding</a>
        
        <a href="#design">design</a>
        
        <a href="#iot">iot</a>
        
        <a href="#code">code</a>
        
        <a href="#mechanical">mechanical</a>
        
        <a href="#javascript">javascript</a>
        
        <a href="#web">web</a>
        
        <a href="#video">video</a>
        
        <a href="#python">python</a>
        
        <a href="#raspberry-pi">raspberry-pi</a>
        
        <a href="#scripting">scripting</a>
        
        <a href="#elastomer">elastomer</a>
        
        <a href="#shell">shell</a>
        
        <a href="#ruby">ruby</a>
        
    </div>

    <div class="portfolio-wrapper">
        
        
        
        
        
        <div class="portfolio-block portfolio-l prototype model arduino control "
            id="portfolio-block-1">
            <div class="portfolio-front"
                style="background-image: url('/assets/img/portfolio/niti-light/11894545_10207114581966072_1589272026712605774_o_10207114581966072.jpg');">
            </div>
            <div class="portfolio-overlay"></div>
            <div class="portfolio-excerpt">
                
                <h3>NiTi light</h3>
                
                <p>
                    
                    Realization of a product design, POC for a graduation project exhibition. Nitinol heated stems for paper flowers, lit by LEDs, in a faux vase. Animation of the flowers by resistively heating the NiTi wires and PWM control of the LEDs brightness. Design by my wife, Aya Shani, as grduation project in product design at H.I.T..

                </p>
            </div>
            <div class="portflio-links">
                
                
                
                <a href="#modal-gallery-1">
                    <i class="material-icons">pageview</i>
                </a>
                
                
            </div>


            

            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            

            
            
            <section aria-hidden="true" aria-labelledby="modal-label" class="portfolio-modal modal--gallery"
                data-cssmodal-resize="true" id="modal-gallery-1" role="dialog" tabindex="-1">
                <div class="modal-inner">
                    <div class="modal-content">
                        <div class="spinner">
                            <div class="spinner__outer"></div>
                            <div class="spinner__inner"></div>
                        </div>


                        <div aria-atomic="false" aria-live="polite" class="modal-detail"></div>

                        <ul class="modal--gallery-navigation">
                            <li>
                                <a class="modal--gallery-navigation-prev" href="#" title="Previous">Previous</a>
                            </li>
                            <li>
                                <a class="modal--gallery-navigation-next" href="#" title="Next">Next</a>
                            </li>
                        </ul>

                    </div>
                    <div class="modal--gallery-caption"></div>

                    <footer>
                        <ul aria-hidden="true" class="modal-content-list is-active">
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-1/1">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/niti-light/11889954_10207114596406433_2522463985584899658_o_10207114596406433.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-1/2">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/niti-light/ezgif.com-gif-maker.gif">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-1/3">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/niti-light/IMG-20191127-WA0010-300x200.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-1/4">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/niti-light/11894545_10207114581966072_1589272026712605774_o_10207114581966072.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-1/5">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/niti-light/11892031_10207087731214820_1210169129953186247_n_10207087731214820.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-1/6">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/niti-light/11907193_10207087731894837_8767404311496339564_n_10207087731894837.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-1/7">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/niti-light/ezgif.com-optimize-1.gif">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-1/8">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/niti-light/11828802_10207063626132208_3432269483034708133_n_10207063626132208.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                        </ul>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">?</a>
            </section>
            
        </div>
        
        
        
        
        
        <div class="portfolio-block portfolio-r plastics-engineering cad cae injection-molding "
            id="portfolio-block-2">
            <div class="portfolio-front"
                style="background-image: url('/assets/img/portfolio/uav-fuel-tank/IMG-20180328-WA0004.jpg');">
            </div>
            <div class="portfolio-overlay"></div>
            <div class="portfolio-excerpt">
                
                <h3>Design for plastic injection molding: UAV fuel tank.</h3>
                
                <p>
                    
                    Material selection, redesign of costumer’s basic design concept, inc. mechanical and Moldflow  FAE, mold design approval and parts approval.
Salaried work for Supergum, as principal design engineer, for security sector costumer.

                </p>
            </div>
            <div class="portflio-links">
                
                
                
                <a href="#modal-gallery-2">
                    <i class="material-icons">pageview</i>
                </a>
                
                
            </div>


            

            
            
            
            
            
            
            
            
            

            
            
            <section aria-hidden="true" aria-labelledby="modal-label" class="portfolio-modal modal--gallery"
                data-cssmodal-resize="true" id="modal-gallery-2" role="dialog" tabindex="-1">
                <div class="modal-inner">
                    <div class="modal-content">
                        <div class="spinner">
                            <div class="spinner__outer"></div>
                            <div class="spinner__inner"></div>
                        </div>


                        <div aria-atomic="false" aria-live="polite" class="modal-detail"></div>

                        <ul class="modal--gallery-navigation">
                            <li>
                                <a class="modal--gallery-navigation-prev" href="#" title="Previous">Previous</a>
                            </li>
                            <li>
                                <a class="modal--gallery-navigation-next" href="#" title="Next">Next</a>
                            </li>
                        </ul>

                    </div>
                    <div class="modal--gallery-caption"></div>

                    <footer>
                        <ul aria-hidden="true" class="modal-content-list is-active">
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-2/1">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/uav-fuel-tank/fuel-tank-cad-iso.png">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-2/2">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/uav-fuel-tank/fuel-tank-cad-bot.png">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-2/3">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/uav-fuel-tank/fuel-tank-bottom-heat.png">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-2/4">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/uav-fuel-tank/IMG-20180328-WA0004.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                        </ul>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">?</a>
            </section>
            
        </div>
        
        
        
        
        
        <div class="portfolio-block portfolio-l design prototype model "
            id="portfolio-block-3">
            <div class="portfolio-front"
                style="background-image: url('/assets/img/portfolio/toy-sound-box-prototype/IMG_20191211_140908.jpg');">
            </div>
            <div class="portfolio-overlay"></div>
            <div class="portfolio-excerpt">
                
                <h3>Toy sound box prototype</h3>
                
                <p>
                    
                    A working model prototype for usability testing of a sound box in a plush toy which is under development.
Usability tested for sound box size, operation and ease of use, and loudness.
Contract work.

                </p>
            </div>
            <div class="portflio-links">
                
                
                
                <a href="#modal-gallery-3">
                    <i class="material-icons">pageview</i>
                </a>
                
                
            </div>


            

            
            
            
            
            
            
            
            
            
            
            
            
            

            
            
            <section aria-hidden="true" aria-labelledby="modal-label" class="portfolio-modal modal--gallery"
                data-cssmodal-resize="true" id="modal-gallery-3" role="dialog" tabindex="-1">
                <div class="modal-inner">
                    <div class="modal-content">
                        <div class="spinner">
                            <div class="spinner__outer"></div>
                            <div class="spinner__inner"></div>
                        </div>


                        <div aria-atomic="false" aria-live="polite" class="modal-detail"></div>

                        <ul class="modal--gallery-navigation">
                            <li>
                                <a class="modal--gallery-navigation-prev" href="#" title="Previous">Previous</a>
                            </li>
                            <li>
                                <a class="modal--gallery-navigation-next" href="#" title="Next">Next</a>
                            </li>
                        </ul>

                    </div>
                    <div class="modal--gallery-caption"></div>

                    <footer>
                        <ul aria-hidden="true" class="modal-content-list is-active">
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-3/1">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/toy-sound-box-prototype/sound_box_proto_281119a_bb-1024x523.png">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-3/2">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/toy-sound-box-prototype/IMG_20191209_141424.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-3/3">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/toy-sound-box-prototype/IMG_20191211_100130.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-3/4">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/toy-sound-box-prototype/IMG_20191211_140908.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-3/5">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/toy-sound-box-prototype/IMG_20191211_141814.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-3/6">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/toy-sound-box-prototype/IMG_20191211_141828.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                        </ul>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">?</a>
            </section>
            
        </div>
        
        
        
        
        
        <div class="portfolio-block portfolio-r iot prototype model arduino code "
            id="portfolio-block-4">
            <div class="portfolio-front"
                style="background-image: url('/assets/img/portfolio/smart-scale/IMG_20190429_161110.jpg');">
            </div>
            <div class="portfolio-overlay"></div>
            <div class="portfolio-excerpt">
                
                <h3>Smart kitchen scale for bread dough</h3>
                
                <p>
                    
                    An ESP32 based kitchen scale for bread baking. Connects to Google sheets over WiFi to retrieve bread formulas, and to save measured weight of ingredients.
BLE serves to define WiFi, as well as display current measurement.
Calculates baker’s percentage on the fly.

                </p>
            </div>
            <div class="portflio-links">
                
                <a href="https://hackaday.io/project/164849-yet-another-smart-kitchen-scale" target="_blank" rel="noopener noreferrer">
                    <i class="material-icons">link</i>
                </a>
                
                
                
                <a href="#modal-gallery-4">
                    <i class="material-icons">pageview</i>
                </a>
                
                
            </div>


            

            
            
            
            
            
            
            

            
            
            <section aria-hidden="true" aria-labelledby="modal-label" class="portfolio-modal modal--gallery"
                data-cssmodal-resize="true" id="modal-gallery-4" role="dialog" tabindex="-1">
                <div class="modal-inner">
                    <div class="modal-content">
                        <div class="spinner">
                            <div class="spinner__outer"></div>
                            <div class="spinner__inner"></div>
                        </div>


                        <div aria-atomic="false" aria-live="polite" class="modal-detail"></div>

                        <ul class="modal--gallery-navigation">
                            <li>
                                <a class="modal--gallery-navigation-prev" href="#" title="Previous">Previous</a>
                            </li>
                            <li>
                                <a class="modal--gallery-navigation-next" href="#" title="Next">Next</a>
                            </li>
                        </ul>

                    </div>
                    <div class="modal--gallery-caption"></div>

                    <footer>
                        <ul aria-hidden="true" class="modal-content-list is-active">
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-4/1">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/smart-scale/IMG_20190429_161110.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-4/2">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/smart-scale/IMG_20190429_160952_cropped.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-4/3">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/smart-scale/ESP32_weight_scale_bb.png">
                                </a>
                                
                            </li>
                            
                            
                            
                        </ul>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">?</a>
            </section>
            
        </div>
        
        
        
        
        
        <div class="portfolio-block portfolio-l mechanical control "
            id="portfolio-block-5">
            <div class="portfolio-front"
                style="background-image: url('/assets/img/portfolio/mechanical-sieve/IMG_20190925_083954-1024x768.jpg');">
            </div>
            <div class="portfolio-overlay"></div>
            <div class="portfolio-excerpt">
                
                <h3>Mechanical Sieve - Shachar Marcus, MUZA, 2019</h3>
                
                <p>
                    
                    Mechanical and electrical design, along with programming. Creating a working installation from the artist’s concept. Construction in collaboration with Studio Omri Ben Artzi, for the exhibition “Data Mining”, Shachar Marcus, MUZA, 2019.

                </p>
            </div>
            <div class="portflio-links">
                
                
                
                <a href="#modal-gallery-5">
                    <i class="material-icons">pageview</i>
                </a>
                
                
            </div>


            

            
            
            
            
            
            
            
            
            
            
            

            
            
            <section aria-hidden="true" aria-labelledby="modal-label" class="portfolio-modal modal--gallery"
                data-cssmodal-resize="true" id="modal-gallery-5" role="dialog" tabindex="-1">
                <div class="modal-inner">
                    <div class="modal-content">
                        <div class="spinner">
                            <div class="spinner__outer"></div>
                            <div class="spinner__inner"></div>
                        </div>


                        <div aria-atomic="false" aria-live="polite" class="modal-detail"></div>

                        <ul class="modal--gallery-navigation">
                            <li>
                                <a class="modal--gallery-navigation-prev" href="#" title="Previous">Previous</a>
                            </li>
                            <li>
                                <a class="modal--gallery-navigation-next" href="#" title="Next">Next</a>
                            </li>
                        </ul>

                    </div>
                    <div class="modal--gallery-caption"></div>

                    <footer>
                        <ul aria-hidden="true" class="modal-content-list is-active">
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-5/1">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/mechanical-sieve/Screenshot_20191003-094618-485x1024.png">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-5/2">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/mechanical-sieve/IMG_20190918_132954-768x576.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-5/3">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/mechanical-sieve/ezgif.com-optimize-2.gif">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-5/4">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/mechanical-sieve/IMG_20190925_083954-1024x768.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-5/5">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/mechanical-sieve/IMG_20190925_090019-768x1019.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                        </ul>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">?</a>
            </section>
            
        </div>
        
        
        
        
        
        <div class="portfolio-block portfolio-r cad design code "
            id="portfolio-block-6">
            <div class="portfolio-front"
                style="background-image: url('/assets/img/portfolio/parametric-design-openscad/SHF_for_print-768x540.png');">
            </div>
            <div class="portfolio-overlay"></div>
            <div class="portfolio-excerpt">
                
                <h3>Parametric design for 3D printing</h3>
                
                <p>
                    
                    Various 3D printed adapters, replacements, and fixes.
Designed in OpenSCAD.

                </p>
            </div>
            <div class="portflio-links">
                
                <a href="https://www.thingiverse.com/UriShX/designs" target="_blank" rel="noopener noreferrer">
                    <i class="material-icons">link</i>
                </a>
                
                
                
                <a href="#modal-gallery-6">
                    <i class="material-icons">pageview</i>
                </a>
                
                
            </div>


            

            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            

            
            
            <section aria-hidden="true" aria-labelledby="modal-label" class="portfolio-modal modal--gallery"
                data-cssmodal-resize="true" id="modal-gallery-6" role="dialog" tabindex="-1">
                <div class="modal-inner">
                    <div class="modal-content">
                        <div class="spinner">
                            <div class="spinner__outer"></div>
                            <div class="spinner__inner"></div>
                        </div>


                        <div aria-atomic="false" aria-live="polite" class="modal-detail"></div>

                        <ul class="modal--gallery-navigation">
                            <li>
                                <a class="modal--gallery-navigation-prev" href="#" title="Previous">Previous</a>
                            </li>
                            <li>
                                <a class="modal--gallery-navigation-next" href="#" title="Next">Next</a>
                            </li>
                        </ul>

                    </div>
                    <div class="modal--gallery-caption"></div>

                    <footer>
                        <ul aria-hidden="true" class="modal-content-list is-active">
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-6/1">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/parametric-design-openscad/SHF_for_print-768x540.png">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-6/2">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/parametric-design-openscad/IMG_0804-768x576.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-6/3">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/parametric-design-openscad/AC_hose_adaptor-768x507.png">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-6/4">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/parametric-design-openscad/IMG_0780-768x576.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-6/5">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/parametric-design-openscad/IMG_0783-768x576.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-6/6">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/parametric-design-openscad/IMG_0781-768x576.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-6/7">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/parametric-design-openscad/tertial-doghole-adapter-768x540.png">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-6/8">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/parametric-design-openscad/IMG_0805-768x576.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-6/9">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/parametric-design-openscad/IMG_0800-768x576.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                        </ul>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">?</a>
            </section>
            
        </div>
        
        
        
        
        
        <div class="portfolio-block portfolio-l iot control javascript arduino code web "
            id="portfolio-block-7">
            <div class="portfolio-front"
                style="background-image: url('/assets/img/portfolio/web-ble-basic-control/ble_slider_web_app_2.png');">
            </div>
            <div class="portfolio-overlay"></div>
            <div class="portfolio-excerpt">
                
                <h3>Web-BLE control app + esp32 sketches</h3>
                
                <p>
                    
                    A web-ble responsive web app to demonstrate control over BLE of ESP32 projects. 
Includes links to github repo of web app, and to a couple of ESP32 sketches for testing.

                </p>
            </div>
            <div class="portflio-links">
                
                <a href="https://github.com/UriShX/ESP32_fader" target="_blank" rel="noopener noreferrer">
                    <i class="material-icons">link</i>
                </a>
                
                
                
                <a href="#stackable-7-1">
                    <i class="material-icons">pageview</i>
                </a>
                
                
            </div>


            

            
            
            <section aria-hidden="true" aria-labelledby="stackable-label" class="modal--show"
                id="stackable-7-1" role="dialog" tabindex="-1">

                <div class="modal-inner">
                    <header>
                        
                        <h2 id="stackable-label">Markdown / Readme</h2>
                        
                    </header>
                    <div class="modal-content">
                        
                        
                        <h1 id="custom-range-slider-wble-write--notify">Custom Range Slider W/BLE Write &amp; Notify</h1>
<h2 id="scope">Scope</h2>
<p>This web app uses <a href="https://developers.google.com/web/updates/2015/07/interact-with-ble-devices-on-the-web">web-ble</a> to control a esp32 device over ble, while subscribing to its’ updates, and includes ‘autoranging’.
App is designed to work with esp32 ble controlled apps, see <a href="https://gist.github.com/UriShX/2b1f1c7b461b466a4b4ae336d52653dd">breathing LED gist</a> and <a href="https://gist.github.com/UriShX/81266ab108876c4ef4252cc9fd3e1432">Hobby servo gist</a>.
App is deployed at https://urishx.github.io/ESP32_fader/.</p>

<h2 id="todo">TODO</h2>
<ul>
  <li>There’s currently no documentation and little to no code remarks in the web app.
    <ul>
      <li>However, The Arduino sketches in the attached Gists are commented pretty well.</li>
    </ul>
  </li>
  <li>There are probably better ways to implement this web-ble web app. It was just a quick test for myself, and as such was not taken too seriously.</li>
  <li>On the UI side, I should probably define several portrait orientation widths, and move the slider accordingly. Right now it is not positioned correctly on all devices.</li>
  <li>On the UX side, I should probably ditch the slider alltogether, and replace it with something that will not cause accidental refreshes.</li>
  <li>I started making this app a PWA, but never quite figured it out completley. It can and should be done.</li>
</ul>

                        
                    </div>
                    <footer>
                        <p>
                            
                            
                            
                            <a class="open-modal" href="#modal-gallery-7" role="button"
                                title="Open gallery modal">Open image gallery</a>
                            
                            
                        </p>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">&times;</a>
            </section>
            
            
            
            
            
            

            
            
            <section aria-hidden="true" aria-labelledby="modal-label" class="portfolio-modal modal--gallery"
                data-cssmodal-resize="true" id="modal-gallery-7" role="dialog" tabindex="-1">
                <div class="modal-inner">
                    <div class="modal-content">
                        <div class="spinner">
                            <div class="spinner__outer"></div>
                            <div class="spinner__inner"></div>
                        </div>


                        <div aria-atomic="false" aria-live="polite" class="modal-detail"></div>

                        <ul class="modal--gallery-navigation">
                            <li>
                                <a class="modal--gallery-navigation-prev" href="#" title="Previous">Previous</a>
                            </li>
                            <li>
                                <a class="modal--gallery-navigation-next" href="#" title="Next">Next</a>
                            </li>
                        </ul>

                    </div>
                    <div class="modal--gallery-caption"></div>

                    <footer>
                        <ul aria-hidden="true" class="modal-content-list is-active">
                            
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-7/2">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/web-ble-basic-control/ble_slider_web_app_2.png">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-7/3">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/web-ble-basic-control/ble_slider_web_app_1.png">
                                </a>
                                
                            </li>
                            
                            
                            
                        </ul>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">?</a>
            </section>
            
        </div>
        
        
        
        
        
        <div class="portfolio-block portfolio-r control prototype arduino "
            id="portfolio-block-8">
            <div class="portfolio-front"
                style="background-image: url('/assets/img/portfolio/ab4mc/IMG_0778-768x576.jpg');">
            </div>
            <div class="portfolio-overlay"></div>
            <div class="portfolio-excerpt">
                
                <h3>AB4MC</h3>
                
                <p>
                    
                    A prototyping platform for musicians, based on  Arduino and a graphical programming environment.
An ongoing project, open hardware and software.

                </p>
            </div>
            <div class="portflio-links">
                
                <a href="https://hackaday.io/project/109296-arduino-blocks-for-midi-controllers" target="_blank" rel="noopener noreferrer">
                    <i class="material-icons">link</i>
                </a>
                
                
                
                <a href="#modal-gallery-8">
                    <i class="material-icons">pageview</i>
                </a>
                
                
            </div>


            

            
            
            
            
            
            
            
            
            
            
            
            
            

            
            
            <section aria-hidden="true" aria-labelledby="modal-label" class="portfolio-modal modal--gallery"
                data-cssmodal-resize="true" id="modal-gallery-8" role="dialog" tabindex="-1">
                <div class="modal-inner">
                    <div class="modal-content">
                        <div class="spinner">
                            <div class="spinner__outer"></div>
                            <div class="spinner__inner"></div>
                        </div>


                        <div aria-atomic="false" aria-live="polite" class="modal-detail"></div>

                        <ul class="modal--gallery-navigation">
                            <li>
                                <a class="modal--gallery-navigation-prev" href="#" title="Previous">Previous</a>
                            </li>
                            <li>
                                <a class="modal--gallery-navigation-next" href="#" title="Next">Next</a>
                            </li>
                        </ul>

                    </div>
                    <div class="modal--gallery-caption"></div>

                    <footer>
                        <ul aria-hidden="true" class="modal-content-list is-active">
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-8/1">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/ab4mc/AB4MC-blockly-768x440.png">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-8/2">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/ab4mc/IMG_0779-768x576.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-8/3">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/ab4mc/IMG_0777-768x576.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-8/4">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/ab4mc/IMG_0794-768x576.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-8/5">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/ab4mc/IMG_0692_crop-768x434.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-8/6">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/ab4mc/IMG_0778-768x576.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                        </ul>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">?</a>
            </section>
            
        </div>
        
        
        
        
        
        <div class="portfolio-block portfolio-l mechanical design control "
            id="portfolio-block-9">
            <div class="portfolio-front"
                style="background-image: url('/assets/img/portfolio/perpetuum-mobile/wheel-right.png');">
            </div>
            <div class="portfolio-overlay"></div>
            <div class="portfolio-excerpt">
                
                <h3>Perpetuum Mobile, Shachar Marcus, MUZA, 2019</h3>
                
                <p>
                    
                    Mechanical design, characterization and selection of drive mechanism / motor, production of shop drawings, supervision on construction. Produced in collaboration with studio Omri Ben Artzi, as an installation in the exhibition “Data Mining”, Shachar Marcus, MUZA, 2019.

                </p>
            </div>
            <div class="portflio-links">
                
                
                
                <a href="#modal-gallery-9">
                    <i class="material-icons">pageview</i>
                </a>
                
                
            </div>


            

            
            
            
            
            
            
            
            
            
            
            

            
            
            <section aria-hidden="true" aria-labelledby="modal-label" class="portfolio-modal modal--gallery"
                data-cssmodal-resize="true" id="modal-gallery-9" role="dialog" tabindex="-1">
                <div class="modal-inner">
                    <div class="modal-content">
                        <div class="spinner">
                            <div class="spinner__outer"></div>
                            <div class="spinner__inner"></div>
                        </div>


                        <div aria-atomic="false" aria-live="polite" class="modal-detail"></div>

                        <ul class="modal--gallery-navigation">
                            <li>
                                <a class="modal--gallery-navigation-prev" href="#" title="Previous">Previous</a>
                            </li>
                            <li>
                                <a class="modal--gallery-navigation-next" href="#" title="Next">Next</a>
                            </li>
                        </ul>

                    </div>
                    <div class="modal--gallery-caption"></div>

                    <footer>
                        <ul aria-hidden="true" class="modal-content-list is-active">
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-9/1">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/perpetuum-mobile/wheel-front-1.png">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-9/2">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/perpetuum-mobile/concept-omri.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-9/3">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/perpetuum-mobile/ezgif.com-optimize-4.gif">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-9/4">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/perpetuum-mobile/wheel-right.png">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-9/5">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/perpetuum-mobile/IMG_20190925_090039.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                        </ul>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">?</a>
            </section>
            
        </div>
        
        
        
        
        
        <div class="portfolio-block portfolio-r mechanical "
            id="portfolio-block-10">
            <div class="portfolio-front"
                style="background-image: url('/assets/img/portfolio/I-vs-Us/I-vs-Us_motor-and-links.jpeg');">
            </div>
            <div class="portfolio-overlay"></div>
            <div class="portfolio-excerpt">
                
                <h3>I vs. Us, Riki Stollar, 2020</h3>
                
                <p>
                    
                    Mechanical design. Design a working mechnical system from the artist’s concept. Construction in collaboration with the artist, for exhibition. Riki Stollar, 2020.

                </p>
            </div>
            <div class="portflio-links">
                
                <a href="https://sof-ha.smkb.ac.il/%d7%a8%d7%99%d7%a7%d7%99-%d7%a1%d7%98%d7%95%d7%9c%d7%a8/" target="_blank" rel="noopener noreferrer">
                    <i class="material-icons">link</i>
                </a>
                
                
                
                <a href="#modal-gallery-10">
                    <i class="material-icons">pageview</i>
                </a>
                
                
            </div>


            

            
            
            
            
            

            
            
            <section aria-hidden="true" aria-labelledby="modal-label" class="portfolio-modal modal--gallery"
                data-cssmodal-resize="true" id="modal-gallery-10" role="dialog" tabindex="-1">
                <div class="modal-inner">
                    <div class="modal-content">
                        <div class="spinner">
                            <div class="spinner__outer"></div>
                            <div class="spinner__inner"></div>
                        </div>


                        <div aria-atomic="false" aria-live="polite" class="modal-detail"></div>

                        <ul class="modal--gallery-navigation">
                            <li>
                                <a class="modal--gallery-navigation-prev" href="#" title="Previous">Previous</a>
                            </li>
                            <li>
                                <a class="modal--gallery-navigation-next" href="#" title="Next">Next</a>
                            </li>
                        </ul>

                    </div>
                    <div class="modal--gallery-caption"></div>

                    <footer>
                        <ul aria-hidden="true" class="modal-content-list is-active">
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-10/1">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/I-vs-Us/I-vs-Us_portrait.jpeg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-10/2">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/I-vs-Us/I-vs-Us_motor-and-links.jpeg">
                                </a>
                                
                            </li>
                            
                            
                            
                        </ul>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">?</a>
            </section>
            
        </div>
        
        
        
        
        
        <div class="portfolio-block portfolio-l design prototype control arduino "
            id="portfolio-block-11">
            <div class="portfolio-front"
                style="background-image: url('/assets/img/portfolio/cap-sense-name-card/Name_card-front-768x576.jpg');">
            </div>
            <div class="portfolio-overlay"></div>
            <div class="portfolio-excerpt">
                
                <h3>Cap-sense name card</h3>
                
                <p>
                    
                    A touch sensitive PCB name card I designed for myself.
Design of the card was meant as playground in which to play around with PCB art, ATtiny13, and some blinking LEDs, while maintaining a balance between playfulness, usability, and low cost.

                </p>
            </div>
            <div class="portflio-links">
                
                <a href="https://hackaday.io/project/160831-cap-sense-name-card" target="_blank" rel="noopener noreferrer">
                    <i class="material-icons">link</i>
                </a>
                
                
                
                <a href="#modal-gallery-11">
                    <i class="material-icons">pageview</i>
                </a>
                
                
            </div>


            

            
            
            
            
            
            
            
            
            
            
            

            
            
            <section aria-hidden="true" aria-labelledby="modal-label" class="portfolio-modal modal--gallery"
                data-cssmodal-resize="true" id="modal-gallery-11" role="dialog" tabindex="-1">
                <div class="modal-inner">
                    <div class="modal-content">
                        <div class="spinner">
                            <div class="spinner__outer"></div>
                            <div class="spinner__inner"></div>
                        </div>


                        <div aria-atomic="false" aria-live="polite" class="modal-detail"></div>

                        <ul class="modal--gallery-navigation">
                            <li>
                                <a class="modal--gallery-navigation-prev" href="#" title="Previous">Previous</a>
                            </li>
                            <li>
                                <a class="modal--gallery-navigation-next" href="#" title="Next">Next</a>
                            </li>
                        </ul>

                    </div>
                    <div class="modal--gallery-caption"></div>

                    <footer>
                        <ul aria-hidden="true" class="modal-content-list is-active">
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-11/1">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/cap-sense-name-card/Name_Card_180902.gif">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-11/2">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/cap-sense-name-card/Name_card-front-768x576.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-11/3">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/cap-sense-name-card/Name_card-back-768x576.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-11/4">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/cap-sense-name-card/NameCard_v0.2_front-1024x565.png">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-11/5">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/cap-sense-name-card/NameCard_v0.2_back-1024x565.png">
                                </a>
                                
                            </li>
                            
                            
                            
                        </ul>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">?</a>
            </section>
            
        </div>
        
        
        
        
        
        <div class="portfolio-block portfolio-r video control python raspberry-pi code scripting limited-hover"
            id="portfolio-block-12">
            <div class="portfolio-front"
                style="background-image: url('/assets/img/logo_code.png');">
            </div>
            <div class="portfolio-overlay"></div>
            <div class="portfolio-excerpt">
                
                <h3>Raspberry Pi - play video when button pressed</h3>
                
                <p>
                    
                    Written for a commercial exhibition, video plays when a user inserts a ‘coin’ to a slot in the enclosure.

                </p>
            </div>
            <div class="portflio-links">
                
                <a href="https://github.com/UriShX/portfolio/blob/master/Raspberry_Pi_play_video_with_GPIO/rPi_play_video_w_GPIO.py" target="_blank" rel="noopener noreferrer">
                    <i class="material-icons">link</i>
                </a>
                
                
                
                <a href="#stackable-12-1">
                    <i class="material-icons">pageview</i>
                </a>
                
                
            </div>


            

            
            
            <section aria-hidden="true" aria-labelledby="stackable-label" class="modal--show"
                id="stackable-12-1" role="dialog" tabindex="-1">

                <div class="modal-inner">
                    <header>
                        
                        <h2 id="stackable-label">Code: python</h2>
                        
                    </header>
                    <div class="modal-content">
                        
                        
                        
                        
<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
</pre></td><td class="code"><pre>                        <span class="c1">#!/usr/bin/env python3
</span>
<span class="c1"># A short python script to play once a video file when button is pressed
# meant to run on Raspberry Pi, with button connected to GPIO 21
# script meant to be used in a commercial exhibition, and button to be pressed by PMMA "coin"
# inserted to slot in arcade-styled enclosure.
# Sample video from https://peach.blender.org/download/
# Requires omxplayer!!
</span>
<span class="kn">import</span> <span class="nn">RPi.GPIO</span> <span class="k">as</span> <span class="n">GPIO</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">omxplayer.player</span> <span class="kn">import</span> <span class="n">OMXPlayer</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="n">GPIO</span><span class="p">.</span><span class="n">setmode</span><span class="p">(</span><span class="n">GPIO</span><span class="p">.</span><span class="n">BCM</span><span class="p">)</span>

<span class="c1"># button on GPIO 21
</span><span class="n">GPIO</span><span class="p">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="n">GPIO</span><span class="p">.</span><span class="n">IN</span><span class="p">,</span> <span class="n">pull_up_down</span><span class="o">=</span><span class="n">GPIO</span><span class="p">.</span><span class="n">PUD_UP</span><span class="p">)</span>
<span class="c1"># indication LED on GPIO 13
</span><span class="n">GPIO</span><span class="p">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="n">GPIO</span><span class="p">.</span><span class="n">OUT</span><span class="p">)</span>
<span class="c1"># DEBUG button on GPIO 24
#GPIO.setup(24, GPIO.IN, pull_up_down=GPIO.PUD_UP)
</span>    
<span class="n">VIDEO_PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s">"/home/pi/mu_code/videos/SampleVideo_1280x720_10mb.mp4"</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">VIDEO_PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    
<span class="n">player</span> <span class="o">=</span> <span class="n">OMXPlayer</span><span class="p">(</span><span class="n">VIDEO_PATH</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="s">'--no-osd --no-keys -b -o hdmi'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">playerExit</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
    <span class="n">player</span><span class="p">.</span><span class="n">quit</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'exit'</span><span class="p">,</span><span class="n">code</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="n">_exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">last_state1</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">input_state1</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">quit_video</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">timer</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">playing</span> <span class="o">=</span> <span class="bp">False</span>

<span class="c1"># set variable for length of video
</span><span class="n">videoLength</span> <span class="o">=</span> <span class="n">player</span><span class="p">.</span><span class="n">duration</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.1</span>

<span class="c1"># after loading pause at end of video
</span><span class="n">sleep</span><span class="p">(</span><span class="n">videoLength</span><span class="p">)</span>
<span class="n">player</span><span class="p">.</span><span class="n">pause</span><span class="p">()</span>
<span class="n">GPIO</span><span class="p">.</span><span class="n">output</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="c1">#Read states of input
</span>    <span class="n">input_state1</span> <span class="o">=</span> <span class="n">GPIO</span><span class="p">.</span><span class="nb">input</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span>

    <span class="c1">#If GPIO(21) is shorted to Ground
</span>    <span class="k">if</span> <span class="n">input_state1</span> <span class="o">!=</span> <span class="n">last_state1</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">playing</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">input_state1</span><span class="p">):</span>
            <span class="n">player</span><span class="p">.</span><span class="n">set_position</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">player</span><span class="p">.</span><span class="n">play</span><span class="p">()</span>
            <span class="n">GPIO</span><span class="p">.</span><span class="n">output</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">playing</span> <span class="o">=</span> <span class="bp">True</span>
    
    <span class="k">if</span> <span class="n">playing</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">timer</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">videoLength</span> <span class="o">-</span> <span class="mf">0.01</span><span class="p">):</span>
            <span class="k">print</span> <span class="p">(</span><span class="s">"Video flie length: %f, Timer: %f"</span> <span class="o">%</span><span class="p">(</span><span class="n">videoLength</span><span class="p">,</span> <span class="n">timer</span><span class="p">))</span>
            <span class="n">timer</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">player</span><span class="p">.</span><span class="n">pause</span><span class="p">()</span>
            <span class="n">GPIO</span><span class="p">.</span><span class="n">output</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">playing</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">timer</span> <span class="o">+=</span> <span class="n">player</span><span class="p">.</span><span class="n">position</span><span class="p">()</span> <span class="o">/</span> <span class="mf">1000.0</span>
    
    <span class="n">player</span><span class="p">.</span><span class="n">exitEvent</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">,</span> <span class="n">exit_code</span><span class="p">:</span> <span class="n">playerExit</span><span class="p">(</span><span class="n">exit_code</span><span class="p">)</span>
    
    <span class="c1">#GPIO(24) to close omxplayer manually - used during debug
</span>    <span class="k">if</span> <span class="n">quit_video</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
<span class="c1">#        pygame.quit()
</span>        <span class="n">player</span><span class="p">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="n">os</span><span class="p">.</span><span class="n">system</span><span class="p">(</span><span class="s">'killall omxplayer.bin'</span><span class="p">)</span>
        <span class="n">playing</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">os</span><span class="p">.</span><span class="n">_exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">break</span>

    <span class="c1">#Set last_input states
</span>    <span class="n">last_state1</span> <span class="o">=</span> <span class="n">input_state1</span>
                        
</pre></td></tr></tbody></table></code></pre></figure>

                        
                        
                    </div>
                    <footer>
                        <p>
                            
                            
                            
                            
                        </p>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">&times;</a>
            </section>
            
            

            
            
        </div>
        
        
        
        
        
        <div class="portfolio-block portfolio-l iot javascript code web "
            id="portfolio-block-13">
            <div class="portfolio-front"
                style="background-image: url('/assets/img/portfolio/web-ble-config-app/Screenshot_2021-02-08_11-45-11.png');">
            </div>
            <div class="portfolio-overlay"></div>
            <div class="portfolio-excerpt">
                
                <h3>Web-BLE configuration of WiFi credentials for ESP32</h3>
                
                <p>
                    
                    A web app written in Nuxt (a Vue framework) for configuration of WiFi credentials for a ESP32 device over web-ble.

                </p>
            </div>
            <div class="portflio-links">
                
                <a href="https://github.com/UriShX/Nuxt_esp32_web-ble_wifi_config" target="_blank" rel="noopener noreferrer">
                    <i class="material-icons">link</i>
                </a>
                
                
                
                <a href="#stackable-13-1">
                    <i class="material-icons">pageview</i>
                </a>
                
                
            </div>


            

            
            
            <section aria-hidden="true" aria-labelledby="stackable-label" class="modal--show"
                id="stackable-13-1" role="dialog" tabindex="-1">

                <div class="modal-inner">
                    <header>
                        
                        <h2 id="stackable-label">Markdown / Readme</h2>
                        
                    </header>
                    <div class="modal-content">
                        
                        
                        <h1 id="nuxtjs-esp32-wifi-configuration-over-bt-le">Nuxt.JS esp32 WiFi configuration over Bt-LE</h1>

<h2 id="general-description">General description</h2>

<p>A web based app used to configure WiFi credentials over Bluetooth LE (BLE), for esp32 based IoT projects. Check it out <em><a href="https://urishx.github.io/Nuxt_esp32_web-ble_wifi_config/">here</a></em>. <br />
The app is written in NuxtJS, a Vue framework for server side rendered apps. This is a recreation of the app, which was originally written using KnockoutJS and JQuery. The main reason for recreating the app was that having the BLE configuration and connection parts as Nuxt / Vue Components can help integrate them further into more complex web applications. <br />
The app interacts with the esp32 using web-bluetooth, which is a web standard under development. Thus, it is available atm (02/2020) only on Chrome browsers, on OSX Yosemite and later, Windows 10, Linux with required bluez version etc., and Android &gt; 6.0. <a href="https://github.com/WebBluetoothCG/web-bluetooth/blob/master/implementation-status.md">Click here for current implementation status</a></p>

<h2 id="requirements">Requirements</h2>

<p>The app relies on communication with a esp32 based device / dev board, set up to support configuration of mutiple APs over BLE. Check it out <em><a href="https://urishx.github.io/Nuxt_esp32_web-ble_wifi_config/">here</a></em>. <br />
The Arduino script can be found at: https://github.com/UriShX/esp32_wifi_ble_advanced, written in PlatformIO (with the Arduino framework). The esp32 app complements this web app in functionality, and supports writing, reading, as well as both WiFi connection status and a list of access points seen by the esp32 device. <br />
The communication with the esp32 device is based on <a href="https://desire.giesecke.tk/index.php/2018/04/06/esp32-wifi-setup-over-ble/">Bernd Giesecke’s ESP32 WiFi configuration over BLE</a>, and intends to replace the native Android Java app Bernd used. It also expands on Bernd’s original use to support connection status reporting and passing a list of SSIDs seen by the esp32. <br />
Sadly, there is no support atm for iOS devices, though I believe it can be possible to achieve with nativescript.</p>

<h4 id="js-libraries-and-css-used">JS libraries and CSS used:</h4>

<ul>
  <li>A custom class, stored in <a href="https://github.com/UriShX/Nuxt_esp32_web-ble_wifi_config/blob/master/assets/espconfig.js">espconfig.js</a>, was created using <a href="https://beaufortfrancois.github.io/sandbox/web-bluetooth/generator/">get Started with Web Bluetooth</a>, a web-ble boilerplate code generator app. <br />
The class is linked to the Nuxt app as a <a href="https://nuxtjs.org/guide/plugins/#name-conventional-plugin">client rendered</a>, <a href="https://nuxtjs.org/guide/plugins/#inject-in-root-amp-context">root injected</a> plugin, which is found <a href="https://github.com/UriShX/Nuxt_esp32_web-ble_wifi_config/blob/master/plugins/espconfig.client.js">here</a>.</li>
  <li><a href="https://bootstrap-vue.org/">BootstrapVue</a> was used in order to keep the design similar to the previous iteration of the app, which used Bootstrap 4.</li>
  <li><a href="https://vuelidate.js.org/">Vuelidate</a> was used to ensure SSID and password fields are not blank before passing the credentials to the device.</li>
  <li><a href="https://material.io/resources/icons/?style=baseline">Material design icons</a> were used throughout, for ease of use in development, through <a href="https://github.com/anteriovieira/nuxt-material-design-icons">nuxt-material-icons</a>.</li>
</ul>

<h2 id="app-features-and-configuration">App features and configuration</h2>

<ul>
  <li>The app does not allow the user to change the visibility of passwords recieved from the esp32 device, as well as accessing the passwords from the console using elment access. Control of this feature is done in <a href="https://github.com/UriShX/Nuxt_esp32_web-ble_wifi_config/blob/master/components/InputPair.vue">InputPair.vue</a>.</li>
  <li>The Arduino sketch for the esp32 requires both SSID and password to be set, for both the primary and secondary fields. Validation is set to require all fields to have content, unless “Configure Secondary SSID” is set to OFF and both the secondary SSID and password fields are blank (and the primary ones have content) - in which case the primary fields’ content will be copied to the secondary. This scheme can be configured in <a href="https://github.com/UriShX/Nuxt_esp32_web-ble_wifi_config/blob/master/components/Config.vue">Config.vue</a>.</li>
  <li>The communication between the esp32 device and the app is slightly obfuscated by doing a XOR operation of the stringified JSON object with the esp32 device’s name. The operation occurs on both the recieve and send operations, and can be found in <a href="https://github.com/UriShX/Nuxt_esp32_web-ble_wifi_config/blob/master/assets/string_helpers.js">string_helpers.js</a>, and its calling functions in <a href="https://github.com/UriShX/Nuxt_esp32_web-ble_wifi_config/blob/master/components/Config.vue">Config.vue</a>.</li>
  <li>The app uses the UUIDs Bernd Giesecke’s used in his original app to maintain backward compatibility.</li>
  <li>The app searches only for devices with a name that starts with “ESP32”, and does not display other devices.
    <ul>
      <li>UUIDs and callbacks used by <a href="https://github.com/UriShX/Nuxt_esp32_web-ble_wifi_config/blob/master/assets/espconfig.js">espconfig.js</a> are set in <a href="https://github.com/UriShX/Nuxt_esp32_web-ble_wifi_config/blob/master/components/Navbar.vue">Navbar.vue</a>.</li>
    </ul>
  </li>
  <li><a href="https://github.com/UriShX/Nuxt_esp32_web-ble_wifi_config/blob/master/static/geo_spoof.js">geo_spoof.js</a> is used to prevent the BLE connection from asking permission to use geolocation services. <em>App still requests location services on Android</em>.
    <ul>
      <li>Android v. 6.0 and above requires <code class="language-plaintext highlighter-rouge">ACCESS_COARSE_LOCATION</code> to be allowed,and <code class="language-plaintext highlighter-rouge">geo_spoof.js</code> is an attempt to mitigate that by providing a false location in order for the app to work even when geolocation cannot be found by the Android device. More info about this subject can be found in <a href="https://stackoverflow.com/questions/33045581/location-needs-to-be-enabled-for-bluetooth-low-energy-scanning-on-android-6-0">this dicussion on stackoverflow.com</a>. I have not tested it on this particular app, but have used this method with success to control a servo over BLE in a basement with no GPS reception for <a href="https://github.com/UriShX/ESP32_fader">another web app</a>.</li>
    </ul>
  </li>
  <li><a href="https://github.com/UriShX/Nuxt_esp32_web-ble_wifi_config/blob/master/assets/navigatorCheck.js">navigatorCheck.js</a> contains the method used to check the users’ OS and browser for compatibilty with the web-bluetooth standard.
    <ul>
      <li>Disabling a “No JavaScript” alert and checking browser and OS for compatibilty is done in <a href="https://github.com/UriShX/Nuxt_esp32_web-ble_wifi_config/blob/master/components/Compatibility.vue">Compatibility.vue</a>.</li>
    </ul>
  </li>
</ul>

<h2 id="build-setup">Build Setup</h2>

<p>Bluetooth-LE requires a secure connection over HTTPS. For development, the <code class="language-plaintext highlighter-rouge">nuxt.config.js</code> file contains links to <a href="https://letsencrypt.org/docs/certificates-for-localhost/#making-and-trusting-your-own-certificates">server key and certificate files</a>, <a href="https://nuxtjs.org/api/configuration-server#example-using-https-configuration">according to Nuxt’s documentation</a>. The files should either be stored in <code class="language-plaintext highlighter-rouge">~/ssl/</code>, or the <code class="language-plaintext highlighter-rouge">server</code> tag in <code class="language-plaintext highlighter-rouge">nuxt.config.js</code> should be edited to fit. <code class="language-plaintext highlighter-rouge">server.host</code> is also set as <code class="language-plaintext highlighter-rouge">0.0.0.0</code>, to allow testing and debugging on connected Android device through local network. <br />
 <br />
This app was set up to be deployed to <a href="https://pages.github.com/">github pages</a>, according to Nuxt’s <a href="https://nuxtjs.org/faq/github-pages#__layout">guide</a>. Since the app was built to be static, the <code class="language-plaintext highlighter-rouge">generate.subFolders</code> property in <code class="language-plaintext highlighter-rouge">nuxt.config,js</code> was <a href="https://nuxtjs.org/api/configuration-generate/#subfolders">set to false, to generate separate files</a> for each of the pages. The <code class="language-plaintext highlighter-rouge">dist</code> folder is white-listed in <code class="language-plaintext highlighter-rouge">.gitignore</code>, and can be easily pushed to <code class="language-plaintext highlighter-rouge">gh-pages</code> branch. More details can be found <a href="https://gist.github.com/belohlavek/61dd16c08cd9c57a168408b9ac4121c2">here</a>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># install dependencies</span>
<span class="nv">$ </span>npm <span class="nb">install</span>

<span class="c"># serve with hot reload at localhost:3000</span>
<span class="nv">$ </span>npm run dev

<span class="c"># build for production</span>
<span class="nv">$ </span>npm run build

<span class="c"># generate static project for github pages deployment</span>
<span class="nv">$ </span>npm run generate:gh-pages

<span class="c"># push dist folder to github pages</span>
<span class="nv">$ </span>git subtree push <span class="nt">--prefix</span> dist origin gh-pages
</code></pre></div></div>

<p>For detailed explanation on how things work, check out <a href="https://nuxtjs.org">Nuxt.js docs</a>.</p>

<h2 id="todo">TODO</h2>

<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Check geolocation spoofing. Android still requests turning on location services, and in testing returns the function from <a href="https://github.com/UriShX/Nuxt_esp32_web-ble_wifi_config/blob/master/static/geo_spoof.js">geo_spoof.js</a>. Not sure if the values are accepted by the navigator. This should be checked in an environment where geolocation is not available, such as a basement.</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Make app progressive using <a href="https://pwa.nuxtjs.org/">Nuxt PWA</a>.</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Replace Bootsrap with either a lighter CSS framework, or a pure CSS / CSS extension language such as Sass.</li>
</ul>

<h3 id="further-goals">Further goals:</h3>

<ul>
  <li>Create native Android and iOS apps using <a href="https://nativescript-vue.org/en/docs/getting-started/code-sharing/">nativescript-vue</a>.</li>
  <li>Setting up a device password and authentication scheme, so not everyone can get to the device and read passwords stored on it.</li>
</ul>

                        
                    </div>
                    <footer>
                        <p>
                            
                            
                            
                            
                        </p>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">&times;</a>
            </section>
            
            

            
            
        </div>
        
        
        
        
        
        <div class="portfolio-block portfolio-r control arduino code limited-hover"
            id="portfolio-block-14">
            <div class="portfolio-front"
                style="background-image: url('/assets/img/logo_code.png');">
            </div>
            <div class="portfolio-overlay"></div>
            <div class="portfolio-excerpt">
                
                <h3>2 DC motors moving in tandem w/ AP for control and monitoring</h3>
                
                <p>
                    
                    ESP32 &amp; Roboclaw control for exhibition in museum.

                </p>
            </div>
            <div class="portflio-links">
                
                <a href="https://github.com/UriShX/portfolio/blob/master/Roboclaw_control_over_ESP32_with_AP_for_control/roboclaw_esp32_w_AP_and_config.ino" target="_blank" rel="noopener noreferrer">
                    <i class="material-icons">link</i>
                </a>
                
                
                
                <a href="#stackable-14-1">
                    <i class="material-icons">pageview</i>
                </a>
                
                
            </div>


            

            
            
            <section aria-hidden="true" aria-labelledby="stackable-label" class="modal--show"
                id="stackable-14-1" role="dialog" tabindex="-1">

                <div class="modal-inner">
                    <header>
                        
                        <h2 id="stackable-label">Code: cpp</h2>
                        
                    </header>
                    <div class="modal-content">
                        
                        
                        
                        
<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp">                        <span class="cm">/*
 * A basic 2*DC motors controller based on ESP32 in AP mode for configuration and maintanence
 * Motor controller is Roboclaw, DC motors are DC geared motors w/ encoder.
 * 
 * Used to power a mechanized exhibit in a museum setting.
 *
 * Uri Shani, 09/2019
 *
 * changed sdk config AMPDU_TX and AMPDU_RX from 1 to 0 (disabled) for AP to work
 * based on https://github.com/espressif/arduino-esp32/issues/2382
 * 
 * AP based on https://resources.basicmicro.com/esp8266-advanced-control-of-roboclaw/
 *  
*/</span>


<span class="c1">//Includes required to use Roboclaw library</span>
<span class="cp">#include &lt;RoboClaw.h&gt;
#include &lt;Preferences.h&gt;
#include &lt;WiFi.h&gt;
#include &lt;WiFiClient.h&gt;
#include &lt;WebServer.h&gt;
#include &lt;SPIFFS.h&gt;
#include &lt;FS.h&gt;
</span><span class="c1">// #include "html_file.h"</span>

<span class="c1">//Serial2 pins</span>
<span class="cp">#define RXD2 16
#define TXD2 17
#define M1_HOME 27
#define M2_HOME 14
</span>
<span class="c1">//RoboClaw address</span>
<span class="cp">#define address 0x80
</span>
<span class="c1">//Velocity PID coefficients</span>
<span class="cp">#define Kp 4.1
#define Ki 0.5
#define Kd 0.25
</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">qpps</span> <span class="o">=</span> <span class="mi">6718</span><span class="p">;</span> <span class="c1">//44000</span>

<span class="kt">bool</span> <span class="n">M1_fault</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span> <span class="c1">// false = no fault; true = could not home</span>
<span class="kt">bool</span> <span class="n">M2_fault</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span> <span class="c1">// false = no fault; true = could not home</span>
<span class="kt">int</span> <span class="n">smalldelay</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span> <span class="c1">// value in seconds</span>
<span class="kt">int</span> <span class="n">nSmallCycle</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// zero indexed</span>
<span class="kt">int</span> <span class="n">smallCycleIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// manual (if) loop</span>
<span class="kt">int</span> <span class="n">delayPeriondInSeconds</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// self explainatory</span>
<span class="kt">int</span> <span class="n">nTimesToMove</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="c1">// complete cycle movement</span>
<span class="kt">bool</span> <span class="n">enableAutoMovement</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span> <span class="c1">// true = auto mode; false = manual mode</span>
<span class="kt">int</span> <span class="n">speedMultiplier</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="c1">// speed = qpps * speedMultiplier</span>
<span class="kt">int</span> <span class="n">accelMultiplier</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span> <span class="c1">// acceleration = qpps * accelMultiplier</span>
<span class="kt">float</span> <span class="n">decelMultiplier</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// deceleration = qpps * decelMultiplier</span>
<span class="kt">int</span> <span class="n">distance</span> <span class="o">=</span> <span class="mi">120</span><span class="p">;</span> <span class="c1">// distance to move before deceleration begins</span>

<span class="kt">bool</span> <span class="n">homing</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">currentTime</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">smallCycleTime</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>

<span class="n">Preferences</span> <span class="n">preferences</span><span class="p">;</span>
<span class="n">RoboClaw</span> <span class="nf">roboclaw</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Serial2</span><span class="p">,</span><span class="mi">20000</span><span class="p">);</span>

<span class="c1">// Replace with your network credentials</span>
<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">ssid</span>     <span class="o">=</span> <span class="s">"AP_SSID"</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">password</span> <span class="o">=</span> <span class="s">"Password"</span><span class="p">;</span>

<span class="c1">// Set web server port number to 80</span>
<span class="n">WebServer</span> <span class="nf">server</span><span class="p">(</span><span class="mi">80</span><span class="p">);</span>

<span class="k">const</span> <span class="kt">char</span> <span class="n">home_page</span><span class="p">[]</span> <span class="o">=</span> <span class="s">R"=====(
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;script&gt;
  function manualControl() {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 &amp;&amp; this.status == 200) {
 
      }
    };
    xhttp.open("GET", "manualorauto", true);
    xhttp.send();
  }
  function sendCommand(chan,state) {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 &amp;&amp; this.status == 200) {
 
      }
    };
    xhttp.open("GET", "handleMotor?motorChannel="+chan+"&amp;motorState="+state, true);
    xhttp.send();
  }
  function home() {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 &amp;&amp; this.status == 200) {
        document.getElementById("homed").innerHTML = this.responseText;
      }
    };
    xhttp.open("GET", "homeMotors", true);
    xhttp.send();
  }
  function move() {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 &amp;&amp; this.status == 200) {
        document.getElementById("movement").innerHTML = this.responseText;
      }
    };
    xhttp.open("GET", "testmovement", true);
    xhttp.send();
  }
  function LoadSavePreferences(action) {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 &amp;&amp; this.status == 200) {
        document.getElementById("preferences").innerHTML = this.responseText;
      }
    };
    xhttp.open("GET", "loadsavepreferences?loadorsave="+action, true);
    xhttp.send();
  }
  function downloadLog(action) {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 &amp;&amp; this.status == 200) {
        document.getElementById("log_status").innerHTML = this.responseText;
      } else if (this.readyState == 4) {
        _OBJECT_URL = URL.createObjectURL(this.response);

    		// Set href as a local object URL
    		document.querySelector('#save-file').setAttribute('href', _OBJECT_URL);
    		
    		// Set name of download
    		document.querySelector('#save-file').setAttribute('download', 'img.jpeg');
      }
    };
    xhttp.open("GET", "handleLogFile?action="+action, true);
    xhttp.send();
  }
  setInterval(function(){
   getManualOrAuto();
  }, 1000);
  setInterval(function(){
   getEnc_1();
  }, 1100);
  setInterval(function(){
   getEnc_2();
  }, 1200);
   setInterval(function(){
   getTemp();
  }, 5000);
   setInterval(function(){
   getVoltage();
  }, 2000);
  function getManualOrAuto() {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if(this.readyState == 4 &amp;&amp; this.status == 200){
        document.getElementById("manualOrAuto").innerHTML = this.responseText;
      }
    };
    xhttp.open("GET","manualorautostate",true);
    xhttp.send();
  }
  function getEnc_1() {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if(this.readyState == 4 &amp;&amp; this.status == 200){
        document.getElementById("encoder_1_value").innerHTML = this.responseText;
      }
    };
    xhttp.open("GET","readEncoder_1",true);
    xhttp.send();
  }
  function getEnc_2() {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if(this.readyState == 4 &amp;&amp; this.status == 200){
        document.getElementById("encoder_2_value").innerHTML = this.responseText;
      }
    };
    xhttp.open("GET","readEncoder_2",true);
    xhttp.send();
  }
  function getTemp() {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if(this.readyState == 4 &amp;&amp; this.status == 200){
        document.getElementById("temp").innerHTML = this.responseText;
      }
    };
    xhttp.open("GET","readTemp",true);
    xhttp.send();
  }
  function getVoltage() {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if(this.readyState == 4 &amp;&amp; this.status == 200){
        document.getElementById("voltage").innerHTML = this.responseText;
      }
    };
    xhttp.open("GET","readVoltage",true);
    xhttp.send();
  }
&lt;/script&gt;
&lt;style&gt;
      .round {
        border-radius: 25px;
        background-color: #cde6f5;
        width: 50%;
        height: 50%;
        margin: 20px;
        padding: 20px;
      }
      .round_big {
        border-radius: 25px;
        background-color: #cdf5f2;
        width: 50%;
        height: 50%;
        margin: 20px;
        padding: 20px;
      }
      h2 {
        color: #707078;
      }
      .button {
        background-color: #87919e;
        display: inline-block;
        border-radius: 10px;
        border: none;
        color: white;
        font-size: 15px;
        padding: 25px;
      }
      span {
        color: #707078;
      }
      p {
        color: #707078;
        font-size: 25px;
      }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="round"&gt;
      &lt;h2&gt;Enable manual control&lt;/h2&gt;
      &lt;button type="button" class="button" onclick="manualControl()"&gt;Manual Control&lt;/button&gt;
      &lt;br /&gt;
      &lt;p&gt;Control: &lt;span id="manualOrAuto"&gt;&lt;/span&gt;&lt;/p&gt;
    &lt;/div&gt;
    &lt;div class="round"&gt;
      &lt;h2&gt;Home&lt;/h2&gt;
      &lt;button type="button" class="button" onclick="home()"&gt;Home Motors&lt;/button&gt;
        &lt;br /&gt;
        &lt;p&gt;&lt;span id="homed"&gt;&lt;/span&gt;&lt;/p&gt;
    &lt;/div&gt;
    &lt;div class="round_big"&gt;
        &lt;h2&gt;Move Motors Manually&lt;/h2&gt;
        &lt;p&gt;Encoder Count: &lt;span id="encoder_1_value"&gt;0&lt;/span&gt;&lt;/p&gt;
        &lt;p&gt;Encoder Count: &lt;span id="encoder_2_value"&gt;0&lt;/span&gt;&lt;/p&gt;
        &lt;svg
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   viewBox="0 0 455.93368 710.97366"
   xml:space="preserve"
   id="svg907"
   version="1.1"&gt;&lt;metadata
     id="metadata913"&gt;&lt;rdf:RDF&gt;&lt;cc:Work
         rdf:about=""&gt;&lt;dc:format&gt;image/svg+xml&lt;/dc:format&gt;&lt;dc:type
           rdf:resource="http://purl.org/dc/dcmitype/StillImage" /&gt;&lt;dc:title&gt;&lt;/dc:title&gt;&lt;/cc:Work&gt;&lt;/rdf:RDF&gt;&lt;/metadata&gt;&lt;defs
     id="defs911"&gt;&lt;clipPath
       id="clipPath923"
       clipPathUnits="userSpaceOnUse"&gt;&lt;path
         id="path921"
         d="m 1881,3584 h 5979 v 9167 H 1881 V 3584" /&gt;&lt;/clipPath&gt;&lt;clipPath
       id="clipPath943"
       clipPathUnits="userSpaceOnUse"&gt;&lt;path
         id="path941"
         d="M 0,0 H 9921 V 14031 H 0 V 0" /&gt;&lt;/clipPath&gt;&lt;clipPath
       id="clipPath973"
       clipPathUnits="userSpaceOnUse"&gt;&lt;path
         id="path971"
         d="M 0,0 H 9921 V 14031 H 0 V 0" /&gt;&lt;/clipPath&gt;&lt;clipPath
       id="clipPath985"
       clipPathUnits="userSpaceOnUse"&gt;&lt;path
         id="path983"
         d="M 0,0 H 9921 V 14031 H 0 V 0" /&gt;&lt;/clipPath&gt;&lt;clipPath
       id="clipPath1091"
       clipPathUnits="userSpaceOnUse"&gt;&lt;path
         id="path1089"
         d="M 0,0 H 9921 V 14031 H 0 V 0" /&gt;&lt;/clipPath&gt;&lt;clipPath
       id="clipPath1103"
       clipPathUnits="userSpaceOnUse"&gt;&lt;path
         id="path1101"
         d="M 0,0 H 9921 V 14031 H 0 V 0" /&gt;&lt;/clipPath&gt;&lt;/defs&gt;&lt;g
     transform="matrix(0.08,0,0,-0.08,-161.66633,1008.88)"
     id="g915"&gt;&lt;g
       id="g917"&gt;&lt;g
         clip-path="url(#clipPath923)"
         id="g919"&gt;&lt;path
           id="path925"
           style="fill:none;stroke:#000000;stroke-width:24;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
           d="M 6008,4683 V 8463 H 5890 V 4683 h 118" /&gt;&lt;path
           id="path927"
           style="fill:none;stroke:#000000;stroke-width:24;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
           d="m 3764,7872 h 2126 v 118 H 3764 v -118" /&gt;&lt;path
           id="path929"
           style="fill:none;stroke:#000000;stroke-width:24;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
           d="m 3646,4683 v 3780 h 118 V 4683 h -118" /&gt;&lt;path
           id="path931"
           style="fill:none;stroke:#000000;stroke-width:24;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
           d="m 3764,5156 v 118 H 5890 V 5156 H 3764" /&gt;&lt;path
           id="path933"
           style="fill:none;stroke:#000000;stroke-width:24;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
           d="M 2033,3736 H 7708 V 8109 L 2745,12599 H 2033 V 3736" /&gt;&lt;path
           id="path935"
           style="fill:none;stroke:#000000;stroke-width:24;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
           d="M 2035,3738 H 7706 V 8108 L 2744,12597 H 2035 V 3738" /&gt;&lt;/g&gt;&lt;/g&gt;&lt;g
       transform="translate(128.34075,35.694545)"
       onclick="sendCommand('1','2')"
       id="M1_R"&gt;&lt;rect
         style="opacity:1;fill:#63f15c;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:23.62204742;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
         id="rect1278"
         width="580.51562"
         height="504.7962"
         x="6360.4321"
         y="-8127.2183"
         transform="scale(1,-1)"
         rx="107.73063"
         ry="125" /&gt;&lt;path
         style="opacity:1;fill:#ff0000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:23.62204742;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
         id="path1280"
         d="m 6951.5,-8013.4106 -314.5576,181.6099 -314.5576,181.6099 0,-363.2199 0,-363.2198 314.5576,181.6099 z"
         transform="matrix(0.47517734,0,0,-0.5086381,3514.4504,3803.6304)" /&gt;&lt;/g&gt;&lt;g
       onclick="sendCommand('1','1')"
       id="M1_L"
       transform="rotate(179.77952,4806.6309,7889.47)"&gt;&lt;rect
         style="opacity:1;fill:#63f15c;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:23.62204742;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
         id="rect1278-6"
         width="580.51562"
         height="504.7962"
         x="6360.4321"
         y="-8127.2183"
         transform="scale(1,-1)"
         rx="107.73063"
         ry="125" /&gt;&lt;path
         style="opacity:1;fill:#ff0000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:23.62204742;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
         id="path1280-7"
         d="m 6951.5,-8013.4106 -314.5576,181.6099 -314.5576,181.6099 0,-363.2199 0,-363.2198 314.5576,181.6099 z"
         transform="matrix(0.47517734,0,0,-0.5086381,3514.4504,3803.6304)" /&gt;&lt;/g&gt;&lt;g
       onclick="sendCommand('2','2')"
       id="M2_R"
       transform="translate(128.34075,-2678.555)"&gt;&lt;rect
         style="opacity:1;fill:#63f15c;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:23.62204742;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
         id="rect1278-3"
         width="580.51562"
         height="504.7962"
         x="6360.4321"
         y="-8127.2183"
         transform="scale(1,-1)"
         rx="107.73063"
         ry="125" /&gt;&lt;path
         style="opacity:1;fill:#ff0000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:23.62204742;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
         id="path1280-5"
         d="m 6951.5,-8013.4106 -314.5576,181.6099 -314.5576,181.6099 0,-363.2199 0,-363.2198 314.5576,181.6099 z"
         transform="matrix(0.47517734,0,0,-0.5086381,3514.4504,3803.6304)" /&gt;&lt;/g&gt;&lt;g
       onclick="sendCommand('2','1')"
       id="M2_L"
       transform="rotate(179.77952,4809.2435,6531.644)"&gt;&lt;rect
         style="opacity:1;fill:#63f15c;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:23.62204742;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
         id="rect1278-6-2"
         width="580.51562"
         height="504.7962"
         x="6360.4321"
         y="-8127.2183"
         transform="scale(1,-1)"
         rx="107.73063"
         ry="125" /&gt;&lt;path
         style="opacity:1;fill:#ff0000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:23.62204742;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
         id="path1280-7-9"
         d="m 6951.5,-8013.4106 -314.5576,181.6099 -314.5576,181.6099 0,-363.2199 0,-363.2198 314.5576,181.6099 z"
         transform="matrix(0.47517734,0,0,-0.5086381,3514.4504,3803.6304)" /&gt;&lt;/g&gt;&lt;g
       onclick="sendCommand('1','0')"
       id="M1_stop"
       transform="translate(-1779.8534,35.694545)"&gt;&lt;rect
         style="opacity:1;fill:#63f15c;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:23.62204742;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
         id="rect1278-2"
         width="580.51562"
         height="504.7962"
         x="6360.4321"
         y="-8127.2183"
         transform="scale(1,-1)"
         rx="107.73063"
         ry="125" /&gt;&lt;rect
         ry="7.0754719"
         rx="67.826851"
         transform="scale(1,-1)"
         y="-8008.6748"
         x="6498.9888"
         height="267.70865"
         width="303.40311"
         id="rect5080"
         style="opacity:1;fill:#ff0000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:14.1020689;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /&gt;&lt;/g&gt;&lt;g
       onclick="sendCommand('2','0')"
       id="M2_stop"
       transform="translate(-1779.8534,-2678.555)"&gt;&lt;rect
         style="opacity:1;fill:#63f15c;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:23.62204742;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
         id="rect1278-2-3"
         width="580.51562"
         height="504.7962"
         x="6360.4321"
         y="-8127.2183"
         transform="scale(1,-1)"
         rx="107.73063"
         ry="125" /&gt;&lt;rect
         ry="7.0754719"
         rx="67.826851"
         transform="scale(1,-1)"
         y="-8008.6748"
         x="6498.9888"
         height="267.70865"
         width="303.40311"
         id="rect5080-6"
         style="opacity:1;fill:#ff0000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:14.1020689;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /&gt;&lt;/g&gt;&lt;rect
       ry="125"
       rx="125"
       transform="scale(1,-1)"
       y="-8841.9111"
       x="2383.1101"
       height="1463.9089"
       width="4997.4824"
       id="rect5141"
       style="opacity:1;fill:none;fill-opacity:1;fill-rule:evenodd;stroke:#807171;stroke-width:23.62204742;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:70.86614175, 23.62204725;stroke-dashoffset:0;stroke-opacity:1" /&gt;&lt;text
       transform="scale(1,-1)"
       id="text5145"
       y="-8390.8818"
       x="4608.6787"
       style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:500px;line-height:1.25;font-family:'Courier 10 Pitch';-inkscape-font-specification:'Courier 10 Pitch';letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:12.5"
       xml:space="preserve"&gt;&lt;tspan
         style="stroke-width:12.5"
         y="-8390.8818"
         x="4608.6787"
         id="tspan5143"&gt;M1&lt;/tspan&gt;&lt;/text&gt;
&lt;rect
       transform="scale(1,-1)"
       ry="125"
       rx="125"
       y="-6115.5767"
       x="2404.4172"
       height="1463.9089"
       width="4997.4824"
       id="rect5141-0"
       style="opacity:1;fill:none;fill-opacity:1;fill-rule:evenodd;stroke:#807171;stroke-width:23.62204742;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:70.86614175, 23.62204725;stroke-dashoffset:0;stroke-opacity:1" /&gt;&lt;text
       transform="scale(1,-1)"
       id="text5145-6"
       y="-5664.5474"
       x="4629.9863"
       style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:500px;line-height:1.25;font-family:'Courier 10 Pitch';-inkscape-font-specification:'Courier 10 Pitch';letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:12.5"
       xml:space="preserve"&gt;&lt;tspan
         style="stroke-width:12.5"
         y="-5664.5474"
         x="4629.9863"
         id="tspan5143-2"&gt;M2&lt;/tspan&gt;&lt;/text&gt;
&lt;/g&gt;&lt;/svg&gt;
    &lt;/div&gt;
    &lt;div class="round"&gt;
      &lt;h2&gt;Test movement&lt;/h2&gt;
      &lt;button type="button" class="button" onclick="move()"&gt;Test movement&lt;/button&gt;
        &lt;br /&gt;
        &lt;p&gt;&lt;span id="movement"&gt;&lt;/span&gt;&lt;/p&gt;
    &lt;/div&gt;
    &lt;div class="round"&gt;
      &lt;h2&gt;Info&lt;/h2&gt;
        &lt;p&gt;Voltage: &lt;span id="voltage"&gt;0&lt;/span&gt;V&lt;/p&gt;
        &lt;p&gt;Temperature: &lt;span id="temp"&gt;0&lt;/span&gt;C&lt;/p&gt;
    &lt;/div&gt;
    &lt;div class="round"&gt;
      &lt;h2&gt;Motor Channel 1&lt;/h2&gt;
      &lt;button type="button" class="button" onclick="sendCommand('1','2')"&gt;Move to wall&lt;/button&gt;
      &lt;button type="button" class="button" onclick="sendCommand('1','1')"&gt;Move away from wall&lt;/button&gt;
        &lt;button type="button" class="button" onclick="sendCommand('1','0')"&gt;Motor Off&lt;/button&gt;
        &lt;br /&gt;
        &lt;br /&gt;
        &lt;p&gt;Encoder Count: &lt;span id="encoder_1_value"&gt;0&lt;/span&gt;&lt;/p&gt;
    &lt;/div&gt;
    &lt;div class="round"&gt;
      &lt;h2&gt;Motor Channel 2&lt;/h2&gt;
      &lt;button type="button" class="button" onclick="sendCommand('2','2')"&gt;Move to wall&lt;/button&gt;
      &lt;button type="button" class="button" onclick="sendCommand('2','1')"&gt;Move away from wall&lt;/button&gt;
        &lt;button type="button" class="button" onclick="sendCommand('2','0')"&gt;Motor Off&lt;/button&gt;
        &lt;br /&gt;
        &lt;br /&gt;
        &lt;p&gt;Encoder Count: &lt;span id="encoder_2_value"&gt;0&lt;/span&gt;&lt;/p&gt;
    &lt;/div&gt;
    &lt;div class="round"&gt;
      &lt;h2&gt;Save state&lt;/h2&gt;
      &lt;button type="button" class="button" onclick="LoadSavePreferences(2)"&gt;Clear preferences and return to defaults&lt;/button&gt;
      &lt;br /&gt;
      &lt;p&gt;Confirmation: &lt;span id="preferences"&gt;&lt;/span&gt;&lt;/p&gt;
    &lt;/div&gt;
    &lt;div class="round"&gt;
      &lt;h2&gt;Handle log&lt;/h2&gt;
      &lt;button type="button" class="button" onclick="downloadLog(0)"&gt;Download log file&lt;/button&gt;
      &lt;br /&gt;
      &lt;button type="button" class="button" onclick="downloadLog(1)"&gt;Delete log file&lt;/button&gt;
      &lt;br /&gt;
      &lt;p&gt;Confirmation: &lt;span id="log_status"&gt;&lt;/span&gt;&lt;/p&gt;
    &lt;/div&gt;
    
&lt;/body&gt;
&lt;/html&gt;
)====="</span><span class="p">;</span>

<span class="c1">// Variable to store the HTTP request</span>
<span class="n">String</span> <span class="n">header</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">movement</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">displayspeed</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">home</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">targetInit</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">handlePreferences</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">handleHome</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">homeMotors</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">handleManualOrAuto</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">handleManualOrAutoState</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">handleEncoder_1</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">handleEncoder_2</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">handleMotor</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">handleTemp</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">handleVoltage</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">handleMovement</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">handleLogFile</span><span class="p">();</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">M1_HOME</span><span class="p">,</span> <span class="n">INPUT_PULLUP</span><span class="p">);</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">M2_HOME</span><span class="p">,</span> <span class="n">INPUT_PULLUP</span><span class="p">);</span>

    <span class="n">preferences</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="s">"roboclaw_defines"</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
    <span class="n">M1_fault</span> <span class="o">=</span> <span class="n">preferences</span><span class="p">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">"M1_fault"</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
    <span class="n">M2_fault</span> <span class="o">=</span> <span class="n">preferences</span><span class="p">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">"M2_fault"</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
    <span class="n">preferences</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">SPIFFS</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="nb">true</span><span class="p">)){</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"An Error has occurred while mounting SPIFFS"</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>


    <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
    <span class="n">roboclaw</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>

    <span class="c1">// Connect to Wi-Fi network with SSID and password, and only one allowed connection</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Setting AP (Access Point)…"</span><span class="p">);</span>
    <span class="n">WiFi</span><span class="p">.</span><span class="n">softAP</span><span class="p">(</span><span class="n">ssid</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

    <span class="n">IPAddress</span> <span class="n">IP</span> <span class="o">=</span> <span class="n">WiFi</span><span class="p">.</span><span class="n">softAPIP</span><span class="p">();</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"AP IP address: "</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">IP</span><span class="p">);</span>
    
    <span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="n">handleHome</span><span class="p">);</span>
    <span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">"/readEncoder_1"</span><span class="p">,</span> <span class="n">handleEncoder_1</span><span class="p">);</span>
    <span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">"/readEncoder_2"</span><span class="p">,</span> <span class="n">handleEncoder_2</span><span class="p">);</span>
    <span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">"/readTemp"</span><span class="p">,</span> <span class="n">handleTemp</span><span class="p">);</span>
    <span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">"/readVoltage"</span><span class="p">,</span> <span class="n">handleVoltage</span><span class="p">);</span>
    <span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">"/handleMotor"</span><span class="p">,</span> <span class="n">handleMotor</span><span class="p">);</span>
    <span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">"/manualorauto"</span><span class="p">,</span> <span class="n">handleManualOrAuto</span><span class="p">);</span>
    <span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">"/manualorautostate"</span><span class="p">,</span> <span class="n">handleManualOrAutoState</span><span class="p">);</span>
    <span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">"/homeMotors"</span><span class="p">,</span> <span class="n">homeMotors</span><span class="p">);</span>
    <span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">"/testmovement"</span><span class="p">,</span><span class="n">handleMovement</span><span class="p">);</span>
    <span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">"/loadsavepreferences"</span><span class="p">,</span><span class="n">handlePreferences</span><span class="p">);</span>
    <span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">"/handleLogFile"</span><span class="p">,</span> <span class="n">handleLogFile</span><span class="p">);</span>

    <span class="n">server</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> 
      
    <span class="n">delay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

    <span class="n">roboclaw</span><span class="p">.</span><span class="n">ResetEncoders</span><span class="p">(</span><span class="n">address</span><span class="p">);</span>

    <span class="n">home</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="n">delay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
    <span class="c1">// roboclaw.SetPinFunctions(address, 0, 3, 0); // set pin 4 as voltage clamp</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">M1_fault</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">M2_fault</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">movement</span><span class="p">();</span>
      <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
      <span class="n">home</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span> 
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span> <span class="c1">//Choose Serial1 or Serial2 as required</span>
  <span class="n">server</span><span class="p">.</span><span class="n">handleClient</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">millis</span><span class="p">()</span> <span class="o">-</span> <span class="n">currentTime</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">delayPeriondInSeconds</span> <span class="o">-</span> <span class="p">(</span><span class="n">smalldelay</span> <span class="o">*</span> <span class="n">nSmallCycle</span><span class="p">))</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">enableAutoMovement</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">smallCycleIndex</span> <span class="o">&lt;</span> <span class="n">nSmallCycle</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">((</span><span class="n">millis</span><span class="p">()</span> <span class="o">-</span> <span class="n">smallCycleTime</span> <span class="o">&gt;</span> <span class="n">smalldelay</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">enableAutoMovement</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="c1">// server.handleClient();</span>
        <span class="n">smallCycleTime</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
        <span class="n">movement</span><span class="p">();</span>
        <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
        <span class="n">home</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>
        <span class="n">smallCycleIndex</span><span class="o">++</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> 
    <span class="p">{</span>
      <span class="n">smallCycleIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">currentTime</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">movement</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">uint8_t</span> <span class="n">depth1</span><span class="p">,</span><span class="n">depth2</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">qppsM1</span> <span class="o">=</span> <span class="n">qpps</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">qppsM2</span> <span class="o">=</span> <span class="mf">0.98</span> <span class="o">*</span> <span class="n">qpps</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">M1_fault</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">M2_fault</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="c1">// roboclaw.SpeedAccelDistanceM1M2(address, uint32_t accel, uint32_t speed1, uint32_t distance1, uint32_t speed2, uint32_t distance2, uint8_t flag=0);</span>
      <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedAccelDistanceM1</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="n">qppsM1</span><span class="o">*</span><span class="n">accelMultiplier</span><span class="p">,</span><span class="n">qppsM1</span><span class="o">*</span><span class="n">speedMultiplier</span><span class="p">,</span><span class="n">distance</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
      <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedAccelDistanceM2</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="n">qppsM2</span><span class="o">*</span><span class="n">accelMultiplier</span><span class="p">,</span><span class="n">qppsM2</span><span class="o">*</span><span class="n">speedMultiplier</span><span class="p">,</span><span class="n">distance</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
      <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedAccelDistanceM1</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="n">qppsM1</span><span class="o">*</span><span class="n">decelMultiplier</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>  <span class="c1">//distance traveled is v*v/2a = 12000*12000/2*12000 = 6000</span>
      <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedAccelDistanceM2</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="n">qppsM2</span><span class="o">*</span><span class="n">decelMultiplier</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>  <span class="c1">//that makes the total move in ondirection 48000</span>
      <span class="k">do</span><span class="p">{</span>
          <span class="c1">// displayspeed();</span>
          <span class="n">roboclaw</span><span class="p">.</span><span class="n">ReadBuffers</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="n">depth1</span><span class="p">,</span><span class="n">depth2</span><span class="p">);</span>
      <span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="n">depth1</span><span class="o">!=</span><span class="mh">0x80</span> <span class="o">&amp;&amp;</span> <span class="n">depth2</span><span class="o">!=</span><span class="mh">0x80</span><span class="p">);</span>	<span class="c1">//loop until distance command completes</span>

      <span class="n">delay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="c1">// roboclaw.SpeedAccelDistanceM1M2(address, uint32_t accel, uint32_t speed1, uint32_t distance1, uint32_t speed2, uint32_t distance2, uint8_t flag=0);</span>
          <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedAccelDistanceM1</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="n">qppsM1</span><span class="o">*</span><span class="n">accelMultiplier</span><span class="p">,</span><span class="o">-</span><span class="n">qppsM1</span><span class="o">*</span><span class="n">speedMultiplier</span><span class="p">,</span><span class="n">distance</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
          <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedAccelDistanceM2</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="n">qppsM2</span><span class="o">*</span><span class="n">accelMultiplier</span><span class="p">,</span><span class="o">-</span><span class="n">qppsM2</span><span class="o">*</span><span class="n">speedMultiplier</span><span class="p">,</span><span class="n">distance</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
          <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedAccelDistanceM1</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="n">qppsM1</span><span class="o">*</span><span class="n">decelMultiplier</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>  <span class="c1">//distance traveled is v*v/2a = 12000*12000/2*12000 = 6000</span>
          <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedAccelDistanceM2</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="n">qppsM2</span><span class="o">*</span><span class="n">decelMultiplier</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>  <span class="c1">//that makes the total move in ondirection 48000</span>
          <span class="k">do</span><span class="p">{</span>
              <span class="c1">// displayspeed();</span>
              <span class="n">roboclaw</span><span class="p">.</span><span class="n">ReadBuffers</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="n">depth1</span><span class="p">,</span><span class="n">depth2</span><span class="p">);</span>
          <span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="n">depth1</span><span class="o">!=</span><span class="mh">0x80</span> <span class="o">&amp;&amp;</span> <span class="n">depth2</span><span class="o">!=</span><span class="mh">0x80</span><span class="p">);</span>	<span class="c1">//loop until distance command completes</span>

          <span class="n">delay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
          
          <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedAccelDistanceM1</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="n">qppsM1</span><span class="o">*</span><span class="n">accelMultiplier</span><span class="p">,</span><span class="n">qppsM1</span><span class="o">*</span><span class="n">speedMultiplier</span><span class="p">,</span><span class="n">distance</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
          <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedAccelDistanceM2</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="n">qppsM2</span><span class="o">*</span><span class="n">accelMultiplier</span><span class="p">,</span><span class="n">qppsM2</span><span class="o">*</span><span class="n">speedMultiplier</span><span class="p">,</span><span class="n">distance</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
          <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedAccelDistanceM1</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="n">qppsM1</span><span class="o">*</span><span class="n">decelMultiplier</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
          <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedAccelDistanceM2</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="n">qppsM2</span><span class="o">*</span><span class="n">decelMultiplier</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
          <span class="k">do</span><span class="p">{</span>
              <span class="c1">// displayspeed();</span>
              <span class="n">roboclaw</span><span class="p">.</span><span class="n">ReadBuffers</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="n">depth1</span><span class="p">,</span><span class="n">depth2</span><span class="p">);</span>
          <span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="n">depth1</span><span class="o">!=</span><span class="mh">0x80</span> <span class="o">&amp;&amp;</span> <span class="n">depth2</span><span class="o">!=</span><span class="mh">0x80</span><span class="p">);</span>	<span class="c1">//loop until distance command completes</span>

          <span class="n">delay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="c1">// roboclaw.SpeedAccelDistanceM1M2(address, uint32_t accel, uint32_t speed1, uint32_t distance1, uint32_t speed2, uint32_t distance2, uint8_t flag=0);</span>
      <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedAccelDistanceM1</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="n">qppsM1</span><span class="o">*</span><span class="n">accelMultiplier</span><span class="p">,</span><span class="o">-</span><span class="n">qppsM1</span><span class="o">*</span><span class="n">speedMultiplier</span><span class="p">,</span><span class="n">distance</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
      <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedAccelDistanceM2</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="n">qppsM2</span><span class="o">*</span><span class="n">accelMultiplier</span><span class="p">,</span><span class="o">-</span><span class="n">qppsM2</span><span class="o">*</span><span class="n">speedMultiplier</span><span class="p">,</span><span class="n">distance</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
      <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedAccelDistanceM1</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="n">qppsM1</span><span class="o">*</span><span class="n">decelMultiplier</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>  <span class="c1">//distance traveled is v*v/2a = 12000*12000/2*12000 = 6000</span>
      <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedAccelDistanceM2</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="n">qppsM2</span><span class="o">*</span><span class="n">decelMultiplier</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>  <span class="c1">//that makes the total move in ondirection 48000</span>
      <span class="k">do</span><span class="p">{</span>
          <span class="c1">// displayspeed();</span>
          <span class="n">roboclaw</span><span class="p">.</span><span class="n">ReadBuffers</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="n">depth1</span><span class="p">,</span><span class="n">depth2</span><span class="p">);</span>
      <span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="n">depth1</span><span class="o">!=</span><span class="mh">0x80</span> <span class="o">&amp;&amp;</span> <span class="n">depth2</span><span class="o">!=</span><span class="mh">0x80</span><span class="p">);</span>	<span class="c1">//loop until distance command completes</span>

      <span class="n">delay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">displayspeed</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">uint8_t</span> <span class="n">status1</span><span class="p">,</span><span class="n">status2</span><span class="p">,</span><span class="n">status3</span><span class="p">,</span><span class="n">status4</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">valid1</span><span class="p">,</span><span class="n">valid2</span><span class="p">,</span><span class="n">valid3</span><span class="p">,</span><span class="n">valid4</span><span class="p">;</span>
    
    <span class="kt">int32_t</span> <span class="n">enc1</span><span class="o">=</span> <span class="n">roboclaw</span><span class="p">.</span><span class="n">ReadEncM1</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">status1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">valid1</span><span class="p">);</span>
    <span class="kt">int32_t</span> <span class="n">enc2</span> <span class="o">=</span> <span class="n">roboclaw</span><span class="p">.</span><span class="n">ReadEncM2</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">status2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">valid2</span><span class="p">);</span>
    <span class="kt">int32_t</span> <span class="n">speed1</span> <span class="o">=</span> <span class="n">roboclaw</span><span class="p">.</span><span class="n">ReadSpeedM1</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">status3</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">valid3</span><span class="p">);</span>
    <span class="kt">int32_t</span> <span class="n">speed2</span> <span class="o">=</span> <span class="n">roboclaw</span><span class="p">.</span><span class="n">ReadSpeedM2</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">status4</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">valid4</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Encoder1:"</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">valid1</span><span class="p">){</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">enc1</span><span class="p">,</span><span class="n">DEC</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">" "</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">status1</span><span class="p">,</span><span class="n">HEX</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">" "</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"failed "</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Encoder2:"</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">valid2</span><span class="p">){</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">enc2</span><span class="p">,</span><span class="n">DEC</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">" "</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">status2</span><span class="p">,</span><span class="n">HEX</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">" "</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"failed "</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Speed1:"</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">valid3</span><span class="p">){</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">speed1</span><span class="p">,</span><span class="n">DEC</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">" "</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"failed "</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Speed2:"</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">valid4</span><span class="p">){</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">speed2</span><span class="p">,</span><span class="n">DEC</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">" "</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"failed "</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">home</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">targetInit</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">bitDirection</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// Bit 1 - Direction (0 = Forward, 1 = Backwards)</span>
    <span class="kt">bool</span> <span class="n">M1_state</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">M2_state</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">distance</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">speed</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
    <span class="kt">uint16_t</span> <span class="n">M1target</span> <span class="o">=</span> <span class="n">qpps</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span>
    <span class="kt">uint16_t</span> <span class="n">M2target</span> <span class="o">=</span> <span class="n">qpps</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span>

    <span class="kt">uint8_t</span> <span class="n">status1</span><span class="p">,</span><span class="n">status2</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">valid1</span><span class="p">,</span><span class="n">valid2</span><span class="p">;</span>
    <span class="kt">int32_t</span> <span class="n">enc1</span><span class="o">=</span> <span class="n">roboclaw</span><span class="p">.</span><span class="n">ReadEncM1</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">status1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">valid1</span><span class="p">);</span>
    <span class="kt">int32_t</span> <span class="n">enc2</span> <span class="o">=</span> <span class="n">roboclaw</span><span class="p">.</span><span class="n">ReadEncM2</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">status2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">valid2</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">valid1</span> <span class="o">&amp;&amp;</span> <span class="n">valid2</span><span class="p">){</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">"Encoder1: %d</span><span class="se">\t</span><span class="s">Encoder2: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">enc1</span><span class="p">,</span> <span class="n">enc2</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Error reading encoders"</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">targetInit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">enc1</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span><span class="k">if</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">enc1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">M1target</span><span class="p">)</span> <span class="n">M1target</span> <span class="o">=</span> <span class="n">enc1</span><span class="p">;}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">enc2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span><span class="k">if</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">enc2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">M2target</span><span class="p">)</span> <span class="n">M2target</span> <span class="o">=</span> <span class="n">enc2</span><span class="p">;}</span>
      <span class="n">M1target</span> <span class="o">+=</span> <span class="n">targetInit</span><span class="p">;</span>
      <span class="n">M2target</span> <span class="o">+=</span> <span class="n">targetInit</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">enc1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">speed</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// Bit 1 - Direction (0 = Forward, 1 = Backwards)</span>
    <span class="k">do</span>
    <span class="p">{</span>
        <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedDistanceM1</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">distance</span><span class="o">++</span><span class="p">;</span>
        <span class="n">M1_state</span> <span class="o">=</span> <span class="n">digitalRead</span><span class="p">(</span><span class="n">M1_HOME</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">M1_state</span> <span class="o">&amp;&amp;</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">M1target</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">M1_state</span><span class="p">)</span> 
    <span class="p">{</span>
      <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedM1</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
      <span class="n">roboclaw</span><span class="p">.</span><span class="n">SetEncM1</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
      <span class="n">M1_fault</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">do</span>
        <span class="p">{</span>
            <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedDistanceM1</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="o">-</span><span class="n">speed</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
            <span class="n">distance</span><span class="o">++</span><span class="p">;</span>
            <span class="n">M1_state</span> <span class="o">=</span> <span class="n">digitalRead</span><span class="p">(</span><span class="n">M1_HOME</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">M1_state</span> <span class="o">&amp;&amp;</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">M1target</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">M1_state</span><span class="p">)</span>
        <span class="p">{</span>
          <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedM1</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
          <span class="n">roboclaw</span><span class="p">.</span><span class="n">SetEncM1</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
          <span class="n">M1_fault</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> 
        <span class="p">{</span>
            <span class="k">do</span>
            <span class="p">{</span>
                <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedDistanceM1</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                <span class="n">distance</span><span class="o">--</span><span class="p">;</span>
                <span class="n">M1_state</span> <span class="o">=</span> <span class="n">digitalRead</span><span class="p">(</span><span class="n">M1_HOME</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">M1_state</span> <span class="o">&amp;&amp;</span> <span class="n">distance</span> <span class="o">&gt;</span> <span class="n">M1target</span><span class="p">);</span>
            <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedM1</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
            <span class="n">M1_fault</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"could not home M1"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="n">distance</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">enc2</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">speed</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">speed</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// Need to check</span>
    <span class="k">do</span>
    <span class="p">{</span>
        <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedDistanceM2</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">distance</span><span class="o">++</span><span class="p">;</span>
        <span class="n">M2_state</span> <span class="o">=</span> <span class="n">digitalRead</span><span class="p">(</span><span class="n">M2_HOME</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">M2_state</span> <span class="o">&amp;&amp;</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">M2target</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">M2_state</span><span class="p">)</span> 
    <span class="p">{</span>
      <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedM2</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
      <span class="n">roboclaw</span><span class="p">.</span><span class="n">SetEncM2</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
      <span class="n">M2_fault</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">do</span>
        <span class="p">{</span>
            <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedDistanceM2</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="o">-</span><span class="n">speed</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
            <span class="n">distance</span><span class="o">++</span><span class="p">;</span>
            <span class="n">M2_state</span> <span class="o">=</span> <span class="n">digitalRead</span><span class="p">(</span><span class="n">M2_HOME</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">M2_state</span> <span class="o">&amp;&amp;</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">M2target</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">M2_state</span><span class="p">)</span> 
        <span class="p">{</span>
          <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedM2</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
          <span class="n">roboclaw</span><span class="p">.</span><span class="n">SetEncM2</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
          <span class="n">M2_fault</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">do</span>
            <span class="p">{</span>
                <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedDistanceM2</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                <span class="n">distance</span><span class="o">--</span><span class="p">;</span>
                <span class="n">M2_state</span> <span class="o">=</span> <span class="n">digitalRead</span><span class="p">(</span><span class="n">M2_HOME</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">M2_state</span> <span class="o">&amp;&amp;</span> <span class="n">distance</span> <span class="o">&gt;</span> <span class="n">M2target</span><span class="p">);</span>
            <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedM2</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
            <span class="n">M2_fault</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"could not home M2"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="n">Preferences</span> <span class="n">preferences</span><span class="p">;</span>
    <span class="n">preferences</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="s">"roboclaw_defines"</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
    <span class="n">preferences</span><span class="p">.</span><span class="n">putBool</span><span class="p">(</span><span class="s">"M1_fault"</span><span class="p">,</span> <span class="n">M1_fault</span><span class="p">);</span>
    <span class="n">preferences</span><span class="p">.</span><span class="n">putBool</span><span class="p">(</span><span class="s">"M2_fault"</span><span class="p">,</span> <span class="n">M2_fault</span><span class="p">);</span>
    <span class="n">preferences</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>

    <span class="c1">// Code to save log in SPIFFS</span>
    <span class="c1">// if (M1_fault || M2_fault)</span>
    <span class="c1">// {</span>
    <span class="c1">//   File file = (!SPIFFS.exists("/log.txt"))?SPIFFS.open("/log.txt", FILE_WRITE):SPIFFS.open("/log.txt", FILE_APPEND);      </span>

    <span class="c1">//   if(!file){</span>
    <span class="c1">//       Serial.println("There was an error opening the file for writing");</span>
    <span class="c1">//       return;</span>
    <span class="c1">//   }</span>
      
    <span class="c1">//   if(file.printf("enc1: %i, enc1_direction: %s, M1_fault: %s, enc2: %i, enc2_direction: %s, M2_fault: %s\n", enc1, (~bitDirection &amp; status1)?"fwd":"bwd"), M1_fault?"fail":"success", enc2, (~bitDirection &amp; status2)?"fwd":"bwd", M2_fault?"fail":"success") {</span>
    <span class="c1">//       Serial.println("File was written");</span>
    <span class="c1">//   }else {</span>
    <span class="c1">//       Serial.println("File write failed");</span>
    <span class="c1">//   }</span>

    <span class="c1">//   file.close();</span>
    <span class="c1">// }</span>

    <span class="n">roboclaw</span><span class="p">.</span><span class="n">ResetEncoders</span><span class="p">(</span><span class="n">address</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">handlePreferences</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">String</span> <span class="n">action</span> <span class="o">=</span> <span class="n">server</span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="s">"loadorsave"</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">action</span> <span class="o">==</span> <span class="s">"2"</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Preferences</span> <span class="n">preferences</span><span class="p">;</span>
    <span class="n">preferences</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="n">preferences</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>
    <span class="n">server</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s">"text/html"</span><span class="p">,</span><span class="s">"cleared preferences"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">handleHome</span><span class="p">(){</span>
  <span class="n">String</span> <span class="n">page</span> <span class="o">=</span> <span class="n">home_page</span><span class="p">;</span>
  <span class="n">server</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s">"text/html"</span><span class="p">,</span><span class="n">page</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">homeMotors</span><span class="p">(){</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">homing</span> <span class="o">==</span> <span class="nb">false</span><span class="p">){</span>
    <span class="n">homing</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="n">String</span> <span class="n">status</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">enableAutoMovement</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">home</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">M1_fault</span><span class="p">)</span> <span class="n">status</span> <span class="o">+=</span> <span class="s">"M1 failed "</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">M2_fault</span><span class="p">)</span> <span class="n">status</span> <span class="o">+=</span> <span class="s">"M2 failed"</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">M1_fault</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">M2_fault</span><span class="p">)</span> <span class="n">status</span> <span class="o">+=</span> <span class="s">"Homed successfully"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="n">status</span> <span class="o">=</span> <span class="s">"Cannot home in Auto Mode!"</span><span class="p">;</span>
    <span class="n">server</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s">"text/html"</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>
    <span class="n">homing</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">handleMovement</span><span class="p">(){</span>
  <span class="n">String</span> <span class="n">status</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">enableAutoMovement</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">M1_fault</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">M2_fault</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">movement</span><span class="p">();</span>
      <span class="n">status</span> <span class="o">+=</span> <span class="s">"Moved motors"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">status</span> <span class="o">+=</span> <span class="s">"Cannot home "</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">M1_fault</span><span class="p">)</span> <span class="n">status</span> <span class="o">+=</span> <span class="s">"M1 "</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">M2_fault</span><span class="p">)</span> <span class="n">status</span> <span class="o">+=</span> <span class="s">"M2"</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="n">status</span> <span class="o">+=</span> <span class="s">"Cannot test movement in Auto Mode!"</span><span class="p">;</span>
  <span class="n">server</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s">"text/html"</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">handleManualOrAuto</span><span class="p">(){</span>
  <span class="n">enableAutoMovement</span> <span class="o">^=</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">handleManualOrAutoState</span><span class="p">(){</span>
  <span class="n">String</span> <span class="n">ManAutoState</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">enableAutoMovement</span><span class="p">)</span> <span class="n">ManAutoState</span> <span class="o">=</span> <span class="s">"Auto"</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">enableAutoMovement</span><span class="p">)</span> <span class="n">ManAutoState</span> <span class="o">=</span> <span class="s">"Manual"</span><span class="p">;</span>
  <span class="n">server</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s">"text/html"</span><span class="p">,</span><span class="n">ManAutoState</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">handleEncoder_1</span><span class="p">(){</span>
  <span class="kt">int</span> <span class="n">enc_value</span> <span class="o">=</span> <span class="n">roboclaw</span><span class="p">.</span><span class="n">ReadEncM1</span><span class="p">(</span><span class="n">address</span><span class="p">);</span>
  <span class="n">String</span> <span class="n">value</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">enc_value</span><span class="p">);</span>
  <span class="n">server</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s">"text/plain"</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
    
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">handleEncoder_2</span><span class="p">(){</span>
  <span class="kt">int</span> <span class="n">enc_value</span> <span class="o">=</span> <span class="n">roboclaw</span><span class="p">.</span><span class="n">ReadEncM2</span><span class="p">(</span><span class="n">address</span><span class="p">);</span>
  <span class="n">String</span> <span class="n">value</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">enc_value</span><span class="p">);</span>
  <span class="n">server</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s">"text/plain"</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
    
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">handleMotor</span><span class="p">(){</span>
  <span class="kt">int</span> <span class="n">speed</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
  <span class="n">String</span> <span class="n">motor_channel</span> <span class="o">=</span> <span class="n">server</span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="s">"motorChannel"</span><span class="p">);</span>
  <span class="n">String</span> <span class="n">motor_state</span> <span class="o">=</span> <span class="n">server</span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="s">"motorState"</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">enableAutoMovement</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">motor_channel</span> <span class="o">==</span> <span class="s">"1"</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">motor_state</span> <span class="o">==</span> <span class="s">"1"</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedDistanceM1</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">qpps</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="c1">// roboclaw.ForwardM1(address, 64);</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">motor_state</span> <span class="o">==</span> <span class="s">"2"</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedDistanceM1</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="o">-</span><span class="n">speed</span><span class="p">,</span> <span class="n">qpps</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="c1">// roboclaw.ForwardM1(address, 64);</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">motor_state</span> <span class="o">==</span> <span class="s">"0"</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedDistanceM1</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">motor_channel</span> <span class="o">==</span> <span class="s">"2"</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">motor_state</span> <span class="o">==</span> <span class="s">"1"</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedDistanceM2</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">qpps</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="c1">// roboclaw.ForwardM2(address, 64);</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">motor_state</span> <span class="o">==</span> <span class="s">"2"</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedDistanceM2</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="o">-</span><span class="n">speed</span><span class="p">,</span> <span class="n">qpps</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="c1">// roboclaw.ForwardM2(address, 64);</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">motor_state</span> <span class="o">==</span> <span class="s">"0"</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">roboclaw</span><span class="p">.</span><span class="n">SpeedDistanceM2</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">handleTemp</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">uint16_t</span> <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">roboclaw</span><span class="p">.</span><span class="n">ReadTemp</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">temp</span><span class="p">);</span>
  <span class="kt">float</span> <span class="n">temp_f</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">temp</span><span class="o">/</span><span class="mi">10</span><span class="p">;</span>
  <span class="n">String</span> <span class="n">temp_str</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">temp_f</span><span class="p">);</span>
  <span class="n">server</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s">"text/plain"</span><span class="p">,</span> <span class="n">temp_str</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">handleVoltage</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">voltage</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">voltage</span> <span class="o">=</span> <span class="n">roboclaw</span><span class="p">.</span><span class="n">ReadMainBatteryVoltage</span><span class="p">(</span><span class="n">address</span><span class="p">);</span>
  <span class="kt">float</span> <span class="n">voltage_f</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">voltage</span><span class="o">/</span><span class="mi">10</span><span class="p">;</span>
  <span class="n">String</span> <span class="n">voltage_str</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">voltage_f</span><span class="p">);</span>
  <span class="n">server</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s">"text/plain"</span><span class="p">,</span> <span class="n">voltage_str</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">handleLogFile</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">String</span> <span class="n">action</span> <span class="o">=</span> <span class="n">server</span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="s">"action"</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">action</span> <span class="o">==</span> <span class="s">"0"</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">SPIFFS</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="s">"/log.txt"</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">File</span> <span class="n">download</span> <span class="o">=</span> <span class="n">SPIFFS</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="s">"/log.txt"</span><span class="p">,</span> <span class="n">FILE_READ</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">download</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">server</span><span class="p">.</span><span class="n">sendHeader</span><span class="p">(</span><span class="s">"Content-Type"</span><span class="p">,</span> <span class="s">"text/text"</span><span class="p">);</span>
        <span class="n">server</span><span class="p">.</span><span class="n">sendHeader</span><span class="p">(</span><span class="s">"Content-Disposition"</span><span class="p">,</span> <span class="s">"attachment; filename=log.txt"</span><span class="p">);</span>
        <span class="n">server</span><span class="p">.</span><span class="n">sendHeader</span><span class="p">(</span><span class="s">"Connection"</span><span class="p">,</span> <span class="s">"close"</span><span class="p">);</span>
        <span class="n">server</span><span class="p">.</span><span class="n">streamFile</span><span class="p">(</span><span class="n">download</span><span class="p">,</span> <span class="s">"application/octet-stream"</span><span class="p">);</span>
        <span class="n">download</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
        <span class="n">server</span><span class="p">.</span><span class="n">client</span><span class="p">().</span><span class="n">stop</span><span class="p">();</span> <span class="c1">// Stop is needed because no content length was sent (?)</span>
      <span class="p">}</span> <span class="k">else</span> <span class="n">server</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s">"text/plain"</span><span class="p">,</span> <span class="s">"/log.txt empty"</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="n">server</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s">"text/plain"</span><span class="p">,</span> <span class="s">"failed to retrieve /log.txt"</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">action</span> <span class="o">==</span> <span class="s">"1"</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">SPIFFS</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="s">"/log.txt"</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">SPIFFS</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">"/log.txt"</span><span class="p">);</span>
      <span class="n">server</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s">"text/plain"</span><span class="p">,</span> <span class="s">"removed /log.txt"</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="n">server</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s">"text/plain"</span><span class="p">,</span> <span class="s">"did not find /log.txt"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
                        </code></pre></figure>

                        
                        
                    </div>
                    <footer>
                        <p>
                            
                            
                            
                            
                        </p>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">&times;</a>
            </section>
            
            

            
            
        </div>
        
        
        
        
        
        <div class="portfolio-block portfolio-l plastics-engineering injection-molding "
            id="portfolio-block-15">
            <div class="portfolio-front"
                style="background-image: url('/assets/img/portfolio/fuel-gun/4-1024x768.jpg');">
            </div>
            <div class="portfolio-overlay"></div>
            <div class="portfolio-excerpt">
                
                <h3>Injection molding - mold approval</h3>
                
                <p>
                    
                    Approval of molded products produced by “Supergum” as contracted work.
Parts were approved according to customer’s requirements, and were collaboratively designed with a leading design studio.

                </p>
            </div>
            <div class="portflio-links">
                
                
                
                <a href="#modal-gallery-15">
                    <i class="material-icons">pageview</i>
                </a>
                
                
            </div>


            

            
            
            
            
            
            
            
            
            

            
            
            <section aria-hidden="true" aria-labelledby="modal-label" class="portfolio-modal modal--gallery"
                data-cssmodal-resize="true" id="modal-gallery-15" role="dialog" tabindex="-1">
                <div class="modal-inner">
                    <div class="modal-content">
                        <div class="spinner">
                            <div class="spinner__outer"></div>
                            <div class="spinner__inner"></div>
                        </div>


                        <div aria-atomic="false" aria-live="polite" class="modal-detail"></div>

                        <ul class="modal--gallery-navigation">
                            <li>
                                <a class="modal--gallery-navigation-prev" href="#" title="Previous">Previous</a>
                            </li>
                            <li>
                                <a class="modal--gallery-navigation-next" href="#" title="Next">Next</a>
                            </li>
                        </ul>

                    </div>
                    <div class="modal--gallery-caption"></div>

                    <footer>
                        <ul aria-hidden="true" class="modal-content-list is-active">
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-15/1">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/fuel-gun/3-1024x768.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-15/2">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/fuel-gun/2-1024x768.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-15/3">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/fuel-gun/1-1024x768.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-15/4">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/fuel-gun/4-1024x768.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                        </ul>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">?</a>
            </section>
            
        </div>
        
        
        
        
        
        <div class="portfolio-block portfolio-r plastics-engineering cad cae injection-molding "
            id="portfolio-block-16">
            <div class="portfolio-front"
                style="background-image: url('/assets/img/portfolio/concrete-pot/concrete-pot-deformation-in-1024x531.jpg');">
            </div>
            <div class="portfolio-overlay"></div>
            <div class="portfolio-excerpt">
                
                <h3>Feasibility study: Concrete pot</h3>
                
                <p>
                    
                    Mechanical FEA of plastic injection molded concrete pouring pot, first step in approval for customer’s design.
Salaried work for “Supergum”, for a customer manufacturing land stabilizing solutions.

                </p>
            </div>
            <div class="portflio-links">
                
                
                
                <a href="#modal-gallery-16">
                    <i class="material-icons">pageview</i>
                </a>
                
                
            </div>


            

            
            
            
            
            
            
            
            
            

            
            
            <section aria-hidden="true" aria-labelledby="modal-label" class="portfolio-modal modal--gallery"
                data-cssmodal-resize="true" id="modal-gallery-16" role="dialog" tabindex="-1">
                <div class="modal-inner">
                    <div class="modal-content">
                        <div class="spinner">
                            <div class="spinner__outer"></div>
                            <div class="spinner__inner"></div>
                        </div>


                        <div aria-atomic="false" aria-live="polite" class="modal-detail"></div>

                        <ul class="modal--gallery-navigation">
                            <li>
                                <a class="modal--gallery-navigation-prev" href="#" title="Previous">Previous</a>
                            </li>
                            <li>
                                <a class="modal--gallery-navigation-next" href="#" title="Next">Next</a>
                            </li>
                        </ul>

                    </div>
                    <div class="modal--gallery-caption"></div>

                    <footer>
                        <ul aria-hidden="true" class="modal-content-list is-active">
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-16/1">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/concrete-pot/concrete-pot-whole-768x444.png">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-16/2">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/concrete-pot/concrete-pot-strain-out-1024x531.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-16/3">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/concrete-pot/concrete-pot-loads-and-fixtures.png">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-16/4">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/concrete-pot/concrete-pot-deformation-in-1024x531.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                        </ul>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">?</a>
            </section>
            
        </div>
        
        
        
        
        
        <div class="portfolio-block portfolio-l plastics-engineering cad elastomer "
            id="portfolio-block-17">
            <div class="portfolio-front"
                style="background-image: url('/assets/img/portfolio/elastomeric-part-design/rotating-boot-cover-768x576.png');">
            </div>
            <div class="portfolio-overlay"></div>
            <div class="portfolio-excerpt">
                
                <h3>Elastomeric part design</h3>
                
                <p>
                    
                    As part of my salaried work for Supergum, I was involved in design and design for manufacture of multiple elastomer parts.
As part of my work there I was involved in elastomeric material selection, advising customers on design decisions, and fitting processes and technologies for particular products.

                </p>
            </div>
            <div class="portflio-links">
                
                
                
                <a href="#modal-gallery-17">
                    <i class="material-icons">pageview</i>
                </a>
                
                
            </div>


            

            
            
            
            
            
            
            

            
            
            <section aria-hidden="true" aria-labelledby="modal-label" class="portfolio-modal modal--gallery"
                data-cssmodal-resize="true" id="modal-gallery-17" role="dialog" tabindex="-1">
                <div class="modal-inner">
                    <div class="modal-content">
                        <div class="spinner">
                            <div class="spinner__outer"></div>
                            <div class="spinner__inner"></div>
                        </div>


                        <div aria-atomic="false" aria-live="polite" class="modal-detail"></div>

                        <ul class="modal--gallery-navigation">
                            <li>
                                <a class="modal--gallery-navigation-prev" href="#" title="Previous">Previous</a>
                            </li>
                            <li>
                                <a class="modal--gallery-navigation-next" href="#" title="Next">Next</a>
                            </li>
                        </ul>

                    </div>
                    <div class="modal--gallery-caption"></div>

                    <footer>
                        <ul aria-hidden="true" class="modal-content-list is-active">
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-17/1">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/elastomeric-part-design/Lens-bumper-PU-768x576.png">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-17/2">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/elastomeric-part-design/flat-cut-seal-with-space-for-vulcanized-connection-768x576.png">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-17/3">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/elastomeric-part-design/rotating-boot-cover-768x576.png">
                                </a>
                                
                            </li>
                            
                            
                            
                        </ul>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">?</a>
            </section>
            
        </div>
        
        
        
        
        
        <div class="portfolio-block portfolio-r scripting shell code raspberry-pi limited-hover"
            id="portfolio-block-18">
            <div class="portfolio-front"
                style="background-image: url('/assets/img/logo_code.png');">
            </div>
            <div class="portfolio-overlay"></div>
            <div class="portfolio-excerpt">
                
                <h3>OpenVPN automatic profile switching for OpenWRT</h3>
                
                <p>
                    
                    An automatic switching script for NordVPN’s OpenVPN profiles, for keeping router connected to the optimal VPN server. Runs on OpenWRT based routers.

                </p>
            </div>
            <div class="portflio-links">
                
                <a href="https://forum.openwrt.org/t/openvpn-profile-switcher-for-nordvpn/85310/5" target="_blank" rel="noopener noreferrer">
                    <i class="material-icons">link</i>
                </a>
                
                
                
                <a href="#stackable-18-1">
                    <i class="material-icons">pageview</i>
                </a>
                
                
            </div>


            

            
            
            <section aria-hidden="true" aria-labelledby="stackable-label" class="modal--show"
                id="stackable-18-1" role="dialog" tabindex="-1">

                <div class="modal-inner">
                    <header>
                        
                        <h2 id="stackable-label">Code: bash</h2>
                        
                    </header>
                    <div class="modal-content">
                        
                        
                        
                        
<figure class="highlight"><pre><code class="language-bash" data-lang="bash">                        <span class="c">#!/bin/sh</span>

<span class="c">###</span>
<span class="c"># vpn-profile-switcher.sh v1.0.0</span>
<span class="c">#</span>
<span class="c"># Script for getting the recommended NordVPN server, downloading the server's OpenVPN config file,</span>
<span class="c"># setting credentials, and configuring OpenWRT for using said server.</span>
<span class="c">#</span>
<span class="c"># For more details see README on: https://github.com/UriShX/vpn-profile-switcher</span>
<span class="c"># or run ./vpn-profile-switcher.sh -h</span>
<span class="c">#</span>
<span class="c"># Written by Uri Shani, 2021</span>
<span class="c"># MIT License</span>
<span class="c">#</span>
<span class="c"># NordVPN API documentation by Milosz Galazka, at: https://blog.sleeplessbeastie.eu/2019/02/18/how-to-use-public-nordvpn-api/</span>
<span class="c">###</span>

<span class="nb">set</span> <span class="nt">-e</span>

<span class="nv">protocol</span><span class="o">=</span><span class="s2">"udp"</span>
<span class="nv">secret</span><span class="o">=</span><span class="s2">"secret"</span>
<span class="nv">recommendations_n</span><span class="o">=</span>1

<span class="k">function </span>show_usage<span class="o">()</span> <span class="o">{</span>
    <span class="nb">printf</span> <span class="s2">"vpn-profile-switcher.sh v1.0.0</span><span class="se">\n</span><span class="s2">"</span>
    <span class="nb">printf</span> <span class="s2">"Get NordVPN recommended profile and set OpenVPN on OpenWRT to use said profile.</span><span class="se">\n\n</span><span class="s2">"</span>
    <span class="nb">printf</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> [options &lt;parameters&gt;]</span><span class="se">\n\n</span><span class="s2">"</span>
    <span class="nb">printf</span> <span class="s2">"Options: </span><span class="se">\n</span><span class="s2">"</span>
    <span class="nb">printf</span> <span class="s2">"  -h | --help,</span><span class="se">\t\t\t\t</span><span class="s2">Print this help message</span><span class="se">\n</span><span class="s2">"</span>
    <span class="nb">printf</span> <span class="s2">"  -p | --protocol &lt; udp | tcp &gt;,</span><span class="se">\t</span><span class="s2">Select either UDP or TCP connection. Default is UDP.</span><span class="se">\n</span><span class="s2">"</span>
    <span class="nb">printf</span> <span class="s2">"  -c | --country &lt; code | name &gt;,</span><span class="se">\t</span><span class="s2">Select Country to filter by. Default is closest to your location.</span><span class="se">\n</span><span class="s2">"</span>
    <span class="nb">printf</span> <span class="s2">"  -g | --group &lt; group_name &gt;,</span><span class="se">\t\t</span><span class="s2">Select group to filter by.</span><span class="se">\n</span><span class="s2">"</span>
    <span class="nb">printf</span> <span class="s2">"  -r | --recommendations &lt; number &gt;,</span><span class="se">\t</span><span class="s2">Number of recommendations to ask from NordVPN API.</span><span class="se">\n</span><span class="s2">"</span>
    <span class="nb">printf</span> <span class="s2">"  -d | --distance &lt; number &gt;,</span><span class="se">\t\t</span><span class="s2">Minimal load distance between recommended server and current configuration.</span><span class="se">\n</span><span class="s2">"</span>
    <span class="nb">printf</span> <span class="s2">"  -l | --login-info &lt; filename &gt;,</span><span class="se">\t</span><span class="s2">Specify file for VPN login credentials. Default is 'secret'.</span><span class="se">\n</span><span class="s2">"</span>
    <span class="nb">printf</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">For more information see README in repo: https://github.com/UriShX/vpn-profile-switcher</span><span class="se">\n</span><span class="s2">"</span>

    <span class="nb">exit</span>
<span class="o">}</span>

<span class="k">function </span>check_required<span class="o">()</span> <span class="o">{</span>
    <span class="nv">WGET</span><span class="o">=</span><span class="si">$(</span>which wget<span class="si">)</span>
    <span class="nv">JSONFILTER</span><span class="o">=</span><span class="si">$(</span>which jsonfilter<span class="si">)</span>
    <span class="nv">LIBUSTREAM</span><span class="o">=</span><span class="si">$(</span>opkg info libustream<span class="k">*</span> | <span class="nb">awk</span> <span class="s1">'/installed/{print $0}'</span><span class="si">)</span>

    <span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="s2">"</span><span class="nv">$WGET</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="o">!</span> <span class="s2">"</span><span class="nv">$JSONFILTER</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="o">!</span> <span class="s2">"</span><span class="nv">$LIBUSTREAM</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="c"># wget: SSL support not available, please install one of the libustream-.*[ssl|tls] packages as well as the ca-bundle and ca-certificates packages.</span>
        logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) You must have the required packages installed: wget jsonfilter libustream*tls</span><span class="se">\n</span><span class="s2">"</span>
        <span class="nb">exit </span>1
    <span class="k">fi</span>
<span class="o">}</span>

<span class="k">function </span>check_is_num<span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="nt">-a</span> <span class="nv">$1</span> <span class="nt">-eq</span> <span class="nv">$1</span> <span class="o">]</span> 2&gt;/dev/null<span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="nv">$1</span>
    <span class="k">else
        </span>logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Parameter </span><span class="nv">$1</span><span class="s2"> is not a number, quitting"</span>
        <span class="nb">exit </span>1
    <span class="k">fi</span>
<span class="o">}</span>

<span class="k">function </span>verify_protocol<span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"tcp"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="o">!</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"udp"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span>logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Protocol must be either udp or tcp, your input was: </span><span class="nv">$1</span><span class="s2">."</span>
        <span class="nb">exit </span>1
    <span class="k">else
        </span><span class="nb">echo</span> <span class="nv">$1</span>
    <span class="k">fi</span>
<span class="o">}</span>

<span class="k">function </span>country_code<span class="o">()</span> <span class="o">{</span>
    <span class="nv">identifier</span><span class="o">=</span><span class="si">$(</span>wget <span class="nt">-q</span> <span class="nt">-O</span> - <span class="s2">"https://raw.githubusercontent.com/urishx/vpn-profile-switcher/db/countries.tsv"</span> | <span class="nb">grep</span> <span class="nt">-iw</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> | <span class="nb">awk</span> <span class="nt">-F</span> <span class="s1">'\t'</span> <span class="s1">'/[0-9]+/{print $1}'</span><span class="si">)</span>

    <span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$identifier</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span>logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) The query you entered ("</span><span class="nv">$1</span><span class="s2">") could not be found in the countries databse."</span>
        logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) You can view the list of countries in which NordVPN has OpenVPN servers online: https://github.com/urishx/vpn-profile-switcher/blob/db/countries.tsv"</span>
        <span class="nb">exit </span>1
    <span class="k">else
        </span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$identifier</span><span class="s2">"</span>
    <span class="k">fi</span>
<span class="o">}</span>

<span class="k">function </span>server_groups<span class="o">()</span> <span class="o">{</span>
    <span class="nv">identifier</span><span class="o">=</span><span class="si">$(</span>wget <span class="nt">-q</span> <span class="nt">-O</span> - <span class="s2">"https://raw.githubusercontent.com/urishx/vpn-profile-switcher/db/server-groups.tsv"</span> | <span class="nb">grep</span> <span class="nt">-iw</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> | <span class="nb">awk</span> <span class="nt">-F</span> <span class="s1">'\t'</span> <span class="s1">'/.*/{print $2}'</span><span class="si">)</span>

    <span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$identifier</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span>logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) The query you entered ("</span><span class="nv">$1</span><span class="s2">") could not be found in the server groups databse."</span>
        logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) You can view the list of NordVPN OpenVPN server groups online: https://github.com/urishx/vpn-profile-switcher/blob/db/server-groups.tsv"</span>
        logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Not all server groups are available for OpenVPN connection, please check NordVPN's server recommendation site: https://nordvpn.com/servers/tools/"</span>
        <span class="nb">exit </span>1
    <span class="k">else
        </span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$identifier</span><span class="s2">"</span>
    <span class="k">fi</span>
<span class="o">}</span>

<span class="k">function </span>get_recommended<span class="o">()</span> <span class="o">{</span>
    <span class="nv">_url</span><span class="o">=</span><span class="s2">"https://api.nordvpn.com/v1/servers/recommendations?"</span>
    <span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$group_identifier</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nv">_url</span><span class="o">=</span><span class="k">${</span><span class="nv">_url</span><span class="k">}</span><span class="s2">"filters[servers_groups][identifier]="</span><span class="k">${</span><span class="nv">group_identifier</span><span class="k">}</span><span class="s2">"&amp;"</span>
    <span class="k">fi
    if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$country_id</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nv">_url</span><span class="o">=</span><span class="k">${</span><span class="nv">_url</span><span class="k">}</span><span class="s2">"filters[country_id]="</span><span class="k">${</span><span class="nv">country_id</span><span class="k">}</span><span class="s2">"&amp;"</span>
    <span class="k">fi
    </span><span class="nv">_url</span><span class="o">=</span><span class="k">${</span><span class="nv">_url</span><span class="k">}</span><span class="s2">"filters[servers_technologies][identifier]=openvpn_"</span><span class="k">${</span><span class="nv">protocol</span><span class="k">}</span><span class="s2">"&amp;limit="</span><span class="k">${</span><span class="nv">recommendations_n</span><span class="k">}</span>
    logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Fetching VPN recommendations from: </span><span class="nv">$_url</span><span class="s2">"</span>
    <span class="nv">_json</span><span class="o">=</span><span class="si">$(</span>wget <span class="nt">-q</span> <span class="nt">-O</span> - <span class="s2">"</span><span class="nv">$_url</span><span class="s2">"</span><span class="si">)</span> <span class="o">||</span> <span class="nb">true
    </span><span class="nv">recommended</span><span class="o">=</span><span class="si">$(</span>jsonfilter <span class="nt">-s</span> <span class="s2">"</span><span class="nv">$_json</span><span class="s2">"</span> <span class="nt">-e</span> <span class="s1">'$[0].hostname'</span><span class="si">)</span> <span class="o">||</span> <span class="nb">true
    </span><span class="nv">recommendations</span><span class="o">=</span><span class="si">$(</span>jsonfilter <span class="nt">-s</span> <span class="s2">"</span><span class="nv">$_json</span><span class="s2">"</span> <span class="nt">-e</span> <span class="s1">'$[*].hostname'</span><span class="si">)</span> <span class="o">||</span> <span class="nb">true
    </span><span class="nv">loads</span><span class="o">=</span><span class="si">$(</span>jsonfilter <span class="nt">-s</span> <span class="s2">"</span><span class="nv">$_json</span><span class="s2">"</span> <span class="nt">-e</span> <span class="s1">'$[*].load'</span><span class="si">)</span> <span class="o">||</span> <span class="nb">true</span>
<span class="o">}</span>

<span class="k">function </span>check_in_configs<span class="o">()</span> <span class="o">{</span>
    <span class="nv">server_name</span><span class="o">=</span><span class="si">$(</span>uci show openvpn | <span class="nb">grep</span> <span class="nv">$recommended</span>.<span class="nv">$protocol</span> | <span class="nb">awk</span> <span class="nt">-F</span> <span class="s1">'\.'</span> <span class="s1">'/config/{print $2}'</span><span class="si">)</span>
<span class="o">}</span>

<span class="k">function </span>check_enabled<span class="o">()</span> <span class="o">{</span>
    <span class="nv">enabled_server</span><span class="o">=</span><span class="si">$(</span>uci show openvpn | <span class="nb">grep</span> <span class="s2">"enabled='1'"</span> | <span class="nb">awk</span> <span class="nt">-F</span> <span class="s1">'\.'</span> <span class="s1">'/.*/{print $2}'</span><span class="si">)</span>
<span class="o">}</span>

<span class="k">function </span>test_current_config<span class="o">()</span> <span class="o">{</span>
    <span class="nv">_enabled_config</span><span class="o">=</span><span class="si">$(</span>uci show openvpn | <span class="nb">grep</span> <span class="s2">"</span><span class="nv">$enabled_server</span><span class="s2">.config"</span> | <span class="nb">awk</span> <span class="nt">-F</span><span class="se">\'</span> <span class="s1">'{sub (/\/etc\/openvpn\//,""); print $2}'</span><span class="si">)</span>

    <span class="k">if</span> <span class="o">[</span> <span class="nv">$recommendations_n</span> <span class="nt">-gt</span> 1 <span class="o">]</span><span class="p">;</span> <span class="k">then
        if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$_enabled_config</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">"</span><span class="nv">$recommended</span><span class="s2">.</span><span class="nv">$protocol</span><span class="s2">.ovpn"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">printf</span> <span class="s2">"Recommended servers ("</span> <span class="o">&gt;</span>recommended_servers.log
            <span class="nb">printf</span> <span class="si">$(</span><span class="nb">date</span> <span class="s2">"+%d.%m.%Y-%H:%M:%S"</span><span class="si">)</span> <span class="o">&gt;&gt;</span>recommended_servers.log
            <span class="nb">printf</span> <span class="s2">"):</span><span class="se">\n</span><span class="s2">"</span> <span class="o">&gt;&gt;</span>recommended_servers.log

            <span class="k">for </span>x <span class="k">in</span> <span class="si">$(</span><span class="nb">seq</span> <span class="nv">$recommendations_n</span><span class="si">)</span><span class="p">;</span> <span class="k">do
                </span><span class="nb">printf</span> <span class="s2">"</span><span class="nv">$x</span><span class="se">\t</span><span class="s2">"</span> <span class="o">&gt;&gt;</span>recommended_servers.log
                <span class="nb">echo</span> <span class="nv">$recommendations</span> | <span class="nb">awk</span> <span class="nt">-v</span> <span class="nv">x</span><span class="o">=</span><span class="nv">$x</span> <span class="s1">'{printf("%s\t"), $x}'</span> <span class="o">&gt;&gt;</span>recommended_servers.log
                <span class="nb">echo</span> <span class="nv">$loads</span> | <span class="nb">awk</span> <span class="nt">-v</span> <span class="nv">x</span><span class="o">=</span><span class="nv">$x</span> <span class="s1">'{printf("%d\n"), $x}'</span> <span class="o">&gt;&gt;</span>recommended_servers.log
            <span class="k">done

            if </span><span class="nb">cat </span>recommended_servers.log | <span class="nb">grep</span> <span class="nt">-q</span> <span class="nv">$_enabled_config</span><span class="p">;</span> <span class="k">then
                </span>logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Enabled config is in recommended severs list"</span>
                test_load_distance <span class="nv">$_enabled_config</span>
            <span class="k">else
                </span>logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Could not find the enabled config in recommended servers list"</span>
            <span class="k">fi
        else
            </span>logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Recommended server is the currently enabled config, quitting"</span>
            <span class="nb">exit </span>0
        <span class="k">fi
    else
        </span>logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Configured to recieve only a single recommendation"</span>
    <span class="k">fi</span>
<span class="o">}</span>

<span class="k">function </span>test_load_distance<span class="o">()</span> <span class="o">{</span>
    <span class="nv">_comp_load</span><span class="o">=</span><span class="si">$(</span><span class="nb">awk</span> <span class="nt">-v</span> <span class="nv">x</span><span class="o">=</span><span class="nv">$1</span> <span class="nt">-F</span> <span class="s1">'\t'</span> <span class="s1">'$2~x {print $3}'</span> &lt;recommended_servers.log<span class="si">)</span>
    <span class="nv">_rec_load</span><span class="o">=</span><span class="si">$(</span><span class="nb">awk</span> <span class="nt">-v</span> <span class="nv">x</span><span class="o">=</span><span class="nv">$recommended</span> <span class="nt">-F</span> <span class="s1">'\t'</span> <span class="s1">'$2~x {print $3}'</span> &lt;recommended_servers.log<span class="si">)</span>

    <span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$load_distance</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">let</span> <span class="s2">"_distance=</span><span class="nv">$_comp_load</span><span class="s2">-</span><span class="nv">$_rec_load</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">true
        </span><span class="k">if</span> <span class="o">[</span> <span class="nv">$_distance</span> <span class="nt">-gt</span> <span class="nv">$load_distance</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span>logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Load on enabled server is more then </span><span class="nv">$load_distance</span><span class="s2"> over recommended server, switching"</span>
        <span class="k">else
            </span>logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Load difference between enabled and recommended servers is smaller then </span><span class="nv">$load_distance</span><span class="s2">, quitting without change"</span>
            <span class="nb">exit </span>0
        <span class="k">fi
    else
        </span>logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) load_distance is not set"</span>
    <span class="k">fi</span>
<span class="o">}</span>

<span class="k">function </span>grab_and_edit_config<span class="o">()</span> <span class="o">{</span>
    wget <span class="nt">-q</span> https://downloads.nordcdn.com/configs/files/ovpn_<span class="nv">$protocol</span>/servers/<span class="nv">$recommended</span>.<span class="nv">$protocol</span>.ovpn
    <span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$recommended</span><span class="s2">.</span><span class="nv">$protocol</span><span class="s2">.ovpn"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span>logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) The recommended server profile could not be downloaded from NordVPN's servers, quitting."</span>
        logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Not all server groups are available for OpenVPN connection, please see the list of available group + country combinations at: https://github.com/UriShX/vpn-profile-switcher/blob/db/group-countries.tsv"</span>
        logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Or check NordVPN's server recommendation site: https://nordvpn.com/servers/tools/"</span>
        <span class="nb">exit </span>1
    <span class="k">fi
    </span><span class="nb">mv</span> <span class="nv">$recommended</span>.<span class="nv">$protocol</span>.ovpn /etc/openvpn/
    <span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"s/auth-user-pass/auth-user-pass </span><span class="nv">$secret</span><span class="s2">/g"</span> /etc/openvpn/<span class="nv">$recommended</span>.<span class="nv">$protocol</span>.ovpn
<span class="o">}</span>

<span class="k">function </span>create_new_entry<span class="o">()</span> <span class="o">{</span>
    <span class="nv">new_server</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$recommended</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="s1">'s/[\.\ -]/_/g'</span> | <span class="nb">sed</span> <span class="s2">"s/com/</span><span class="nv">$protocol</span><span class="s2">/g"</span><span class="si">)</span>
    uci <span class="nb">set </span>openvpn.<span class="nv">$new_server</span><span class="o">=</span>openvpn
    uci <span class="nb">set </span>openvpn.<span class="nv">$new_server</span>.config<span class="o">=</span><span class="s2">"/etc/openvpn/</span><span class="nv">$recommended</span><span class="s2">.</span><span class="nv">$protocol</span><span class="s2">.ovpn"</span>
<span class="o">}</span>

<span class="k">function </span>enable_existing_entry<span class="o">()</span> <span class="o">{</span>
    <span class="nb">eval </span>uci <span class="nb">set </span>openvpn.<span class="nv">$1</span>.enabled<span class="o">=</span><span class="s1">'1'</span>
<span class="o">}</span>

<span class="k">function </span>disable_current_entry<span class="o">()</span> <span class="o">{</span>
    <span class="nb">eval </span>uci del openvpn.<span class="nv">$1</span>.enabled
<span class="o">}</span>

<span class="k">function </span>list_ovpn_configs<span class="o">()</span> <span class="o">{</span>
    uci show openvpn | <span class="nb">grep </span>nordvpn | <span class="k">while </span><span class="nb">read </span>y<span class="p">;</span> <span class="k">do
        if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">==</span> <span class="s1">'files'</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="si">$(</span><span class="nb">awk</span> <span class="nt">-F</span><span class="se">\'</span> <span class="s1">'/config/{print $2}'</span><span class="si">)</span>
        <span class="k">elif</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">==</span> <span class="s1">'names'</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="si">$(</span><span class="nb">awk</span> <span class="nt">-F</span> <span class="s1">'.'</span> <span class="s1">'/config/{print $2}'</span><span class="si">)</span>
        <span class="k">else
            </span>logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) bad argument </span><span class="nv">$1</span><span class="s2"> in list_ovpn_configs()"</span>
        <span class="k">fi
    done</span>
<span class="o">}</span>

<span class="k">function </span>remove_unused<span class="o">()</span> <span class="o">{</span>
    <span class="nv">nordvpn_configs</span><span class="o">=</span><span class="si">$(</span>list_ovpn_configs names<span class="si">)</span>
    <span class="nv">nordvpn_files</span><span class="o">=</span><span class="si">$(</span>list_ovpn_configs files<span class="si">)</span>

    <span class="k">for </span>X <span class="k">in</span> <span class="nv">$nordvpn_configs</span><span class="p">;</span> <span class="k">do
        if</span> <span class="o">[</span> <span class="o">!</span> <span class="s2">"</span><span class="nv">$X</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"</span><span class="nv">$server_name</span><span class="s2">"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="o">!</span> <span class="s2">"</span><span class="nv">$X</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"</span><span class="nv">$new_server</span><span class="s2">"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="o">!</span> <span class="s2">"</span><span class="nv">$X</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"</span><span class="nv">$enabled_server</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span>uci del openvpn.<span class="nv">$X</span>
        <span class="k">fi
    done

    </span>uci commit

    <span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$enabled_server</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nv">_enabled_config</span><span class="o">=</span><span class="s2">"/etc/openvpn/"</span><span class="k">${</span><span class="nv">_enabled_config</span><span class="k">}</span>
    <span class="k">fi
    if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$server_name</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nv">existing_file</span><span class="o">=</span><span class="si">$(</span>uci show openvpn.<span class="nv">$server_name</span>.config | <span class="nb">awk</span> <span class="nt">-F</span><span class="se">\'</span> <span class="s1">'{print $2}'</span><span class="si">)</span>
    <span class="k">fi
    if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$new_server</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nv">new_file</span><span class="o">=</span><span class="si">$(</span>uci show openvpn.<span class="nv">$new_server</span>.config | <span class="nb">awk</span> <span class="nt">-F</span><span class="se">\'</span> <span class="s1">'{print $2}'</span><span class="si">)</span>
    <span class="k">fi

    for </span>X <span class="k">in</span> <span class="nv">$nordvpn_files</span><span class="p">;</span> <span class="k">do
        if</span> <span class="o">[</span> <span class="o">!</span> <span class="s2">"</span><span class="nv">$X</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"</span><span class="nv">$_enabled_config</span><span class="s2">"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="o">!</span> <span class="s2">"</span><span class="nv">$X</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"</span><span class="nv">$existing_file</span><span class="s2">"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="o">!</span> <span class="s2">"</span><span class="nv">$X</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"</span><span class="nv">$new_file</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">rm</span> <span class="nv">$X</span>
        <span class="k">fi
    done</span>
<span class="o">}</span>

<span class="k">function </span>restart_openvpn<span class="o">()</span> <span class="o">{</span>
    uci commit openvpn
    /etc/init.d/openvpn restart
<span class="o">}</span>

<span class="c">### RUN ###</span>
<span class="c"># if [[ $# -gt 3 ]] || [[ $# -eq 0 ]]; then</span>
<span class="c">#     echo "Either 0 or more than 3 input arguments provided which is not supported"</span>
<span class="c">#     show_usage</span>
<span class="c">#     exit 1</span>
<span class="c"># fi</span>

check_required

<span class="k">while</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">do
    case</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="k">in</span>
    <span class="nt">-h</span> <span class="p">|</span> <span class="nt">--help</span><span class="p">)</span>
        show_usage
        <span class="p">;;</span>
    <span class="nt">-p</span> <span class="p">|</span> <span class="nt">--protocol</span><span class="p">)</span>
        <span class="nb">shift
        </span><span class="nv">protocol</span><span class="o">=</span><span class="si">$(</span>verify_protocol <span class="nv">$1</span><span class="si">)</span>
        <span class="p">;;</span>
    <span class="nt">-c</span> <span class="p">|</span> <span class="nt">--country</span><span class="p">)</span>
        <span class="nb">shift
        </span><span class="nv">country_id</span><span class="o">=</span><span class="si">$(</span>country_code <span class="nv">$1</span><span class="si">)</span>
        <span class="p">;;</span>
    <span class="nt">-g</span> <span class="p">|</span> <span class="nt">--group</span><span class="p">)</span>
        <span class="nb">shift
        </span><span class="nv">group_identifier</span><span class="o">=</span><span class="si">$(</span>server_groups <span class="nv">$1</span><span class="si">)</span>
        <span class="p">;;</span>
    <span class="nt">-r</span> <span class="p">|</span> <span class="nt">--recommendations</span><span class="p">)</span>
        <span class="nb">shift
        </span><span class="nv">recommendations_n</span><span class="o">=</span><span class="si">$(</span>check_is_num <span class="nv">$1</span><span class="si">)</span>
        <span class="p">;;</span>
    <span class="nt">-d</span> <span class="p">|</span> <span class="nt">--distance</span><span class="p">)</span>
        <span class="nb">shift
        </span><span class="nv">load_distance</span><span class="o">=</span><span class="si">$(</span>check_is_num <span class="nv">$1</span><span class="si">)</span>
        <span class="p">;;</span>
    <span class="nt">-l</span> <span class="p">|</span> <span class="nt">--login-info</span><span class="p">)</span>
        <span class="nb">shift
        </span><span class="nv">secret</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
        <span class="p">;;</span>
    <span class="k">*</span><span class="p">)</span>
        logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Incorrect input provided"</span>
        show_usage
        <span class="p">;;</span>
    <span class="k">esac</span>
    <span class="nb">shift
</span><span class="k">done

</span>logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Arguments: Protocol: </span><span class="nv">$protocol</span><span class="s2">; Country: </span><span class="nv">$country_id</span><span class="s2">; NordVPN group: </span><span class="nv">$group_identifier</span><span class="s2">; User credentials: </span><span class="nv">$secret</span><span class="s2">."</span>

get_recommended

<span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$recommended</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span>logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Could not get recommended VPN, exiting script"</span>
    logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) This might be due to a group + country combination, or server group which is not supported by OpenVPN connection."</span>
    logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) To tune your request, please see the list of available combinations at: https://github.com/UriShX/vpn-profile-switcher/blob/db/group-countries.tsv"</span>
    logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Or check NordVPN's server recommendation site: https://nordvpn.com/servers/tools/"</span>
    <span class="nb">exit
</span><span class="k">fi

</span>logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Recommended server URL: </span><span class="nv">$recommended</span><span class="s2">."</span>

check_in_configs

check_enabled

logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Currently active server: </span><span class="nv">$enabled_server</span><span class="s2">"</span>

test_current_config

<span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$server_name</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span>logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Fetching OpenVPN config </span><span class="nv">$recommended</span><span class="s2">.</span><span class="nv">$protocol</span><span class="s2">.ovpn, and setting credentials"</span>
    grab_and_edit_config
    create_new_entry
    logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Entered new entry to OpenVPN configs: </span><span class="nv">$new_server</span><span class="s2">"</span>
<span class="k">else
    </span>logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Recommended server name: </span><span class="nv">$server_name</span><span class="s2">"</span>
<span class="k">fi

if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$enabled_server</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"</span><span class="nv">$server_name</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span>logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Recommended server is already configured as active"</span>
    <span class="nb">exit
</span><span class="k">else
    if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$new_server</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span>logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Enabling existing entry"</span>
        enable_existing_entry <span class="nv">$server_name</span>
    <span class="k">else
        </span>logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Enabling new entry"</span>
        enable_existing_entry <span class="nv">$new_server</span>
    <span class="k">fi
    </span>logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Disabling current active server"</span>
    disable_current_entry <span class="nv">$enabled_server</span>
<span class="k">fi

</span>logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Comitting changes and restarting OpenVPN"</span>

restart_openvpn

logger <span class="nt">-s</span> <span class="s2">"(</span><span class="nv">$0</span><span class="s2">) Removing unused NordVPN profiles, leaving current and last used."</span>
remove_unused
                        </code></pre></figure>

                        
                        
                    </div>
                    <footer>
                        <p>
                            
                            
                            
                            <a class="open-modal" href="#modal-gallery-18" role="button"
                                title="Open gallery modal">Open image gallery</a>
                            
                            
                        </p>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">&times;</a>
            </section>
            
            
            
            <section aria-hidden="true" aria-labelledby="stackable-label" class="modal--show"
                id="stackable-18-2" role="dialog" tabindex="-1">

                <div class="modal-inner">
                    <header>
                        
                        <h2 id="stackable-label">Markdown / Readme</h2>
                        
                    </header>
                    <div class="modal-content">
                        
                        
                        <h1 id="vpn-profile-switcher">vpn-profile-switcher</h1>

<p><code class="language-plaintext highlighter-rouge">-ash</code> shell script for getting the recommended NordVPN server, downloading said server’s OpenVPN config file, setting credentials, and configuring OpenWRT for using said server.</p>

<h3 id="description">Description</h3>

<p>The script is meant to be run either from the command line (once), or from <a href="https://openwrt.org/docs/guide-user/base-system/cron">crontab</a> as a scheduled task.</p>

<p>By running the script from the command line once with the desired parameters (<a href="https://github.com/UriShX/vpn-profile-switcher/blob/main/countries.tsv">country</a>, <a href="https://support.nordvpn.com/General-info/Features/1047407962/What-do-the-different-server-categories-mean.htm">server group</a>, and <a href="https://www.fastestvpnguide.com/openvpn-tcp-vs-udp/">connection protocol</a>), a recommended VPN server profile is retrieved and set as the active OpenVPN profile.</p>

<p>By running the script from a <a href="https://openwrt.org/docs/guide-user/base-system/cron">crontab</a> with the desired parameters, users can maintain the optimal connection to the desired server country and group combination with the required protocol. This can be done by scheduling the script to run once per hour, for example. <br />
By using crontab, it is also possible to schedule connection to different VPN servers at certain times in a day or in a week.</p>

<p>The script outputs both error messages and normal operation log messages using OpenWRT’s <a href="https://openwrt.org/docs/guide-user/base-system/log.essentials">logger</a>, using the <code class="language-plaintext highlighter-rouge">-s</code> flag. That means log messages are both logged in the system log, as well as seen displayed to the user when running from CLI.</p>

<p>The script scrubs unused profiles by removing them from the OpenWRT OpenVPN configuration and deleting the respective <code class="language-plaintext highlighter-rouge">.ovpn</code> files. <br />
The reason for saving at least the last used profile is that from my experience, sometimes a recommended server is actually too busy to operate reliably. In that case, switching to the last known good profile provides a good alternative, giving the opportunity to request a different server once again. <em>This should probably be written in a script that’ll replace NordVPN’s keep-alive script</em>. <br />
Only the currently used and the previous profiles are kept on the device. <em>An additional option for keeping more profiles on the device is planned, using regular expressions as the option’s parameter</em>.</p>

<p>The <a href="https://github.com/UriShX/vpn-profile-switcher/blob/db/countries.tsv">countries</a> in which NordVPN operates servers, and the <a href="https://github.com/UriShX/vpn-profile-switcher/blob/db/server-groups.tsv">server groups</a> are retrieved from this repository, in the <a href="https://github.com/UriShX/vpn-profile-switcher/tree/db">db</a> branch. <br />
The <a href="https://github.com/UriShX/vpn-profile-switcher/blob/db/group-countries.tsv">group-countries.tsv</a> table displays the possible combinations. <br />
The db branch is configured to be <a href="https://github.com/UriShX/vpn-profile-switcher/blob/main/.github/workflows/main.yml">updated every 15 minutes</a> by a <a href="https://github.com/UriShX/curl-then-jq-shell-action">Github action</a>. In practice, the Github scheduling (for free repositories at least) runs the action at best once an hour. Not ideal, but until I figure out a better filtering system that doesn’t require installing <a href="https://stedolan.github.io/jq/">JQ</a> (~93 kB) on the router, scraping NordVPN’s API on a remote machine seems like a better approach for the meantime. <strong>Please notice: It appears that the API lists different servers at different times, so re-check if you couldn’t get to the servers you wanted to connect to.</strong></p>

<h3 id="about-server-groups-and-server-group--country-combinations">About server groups and server group + country combinations</h3>

<p>NordVPN does not provide OpenVPN profiles ready to download for all groups, and does not provide every server groups in each country. This means that for some queries to the NordVPN API will return empty, and for others a <code class="language-plaintext highlighter-rouge">.ovpn</code> configuration file will not be downloaded. In those cases the script should fail gracefully with failure messages printed to system log, as well as to the terminal when running the script from CLI.</p>

<p>The best way to figure out if your parameters will actually work is to check the <a href="https://github.com/UriShX/vpn-profile-switcher/blob/db/group-countries.tsv">group-countries.tsv</a> table, which is set up to be scraped every 15 minutes (doesn’t really work on schedule, but about once an hour seems good enough). <br />
I noticed some recommended server for group and country combinations from <a href="https://nordvpn.com/servers/tools/">NordVPN server recommendation site</a> did not show up in my scraped tables. Since the script downloads and connections are based on queries to NordVPN’s API, and the tables the script queries are also scraped from the same API, I did not try to fix that. <br />
Of course, it is also possible to try the group + country combination from the script’s CLI.</p>

<h4 id="server-groups-known-to-work-with-countries-in-which-there-are-servers-of-that-group-with-openvpn-profiles">Server groups known to work, with countries in which there are servers of that group, with OpenVPN profiles</h4>

<table>
  <thead>
    <tr>
      <th>Title</th>
      <th style="text-align: center">Remarks</th>
      <th style="text-align: left">Works in the following countries</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Double_VPN</td>
      <td style="text-align: center">-</td>
      <td style="text-align: left">CA, CH, FR, GB, HK, NL, SE, TW, US</td>
    </tr>
    <tr>
      <td>Onion_Over_VPN</td>
      <td style="text-align: center">Shaky, usually returns only one</td>
      <td style="text-align: left">(NL, CH)</td>
    </tr>
    <tr>
      <td>Dedicated_IP</td>
      <td style="text-align: center">Depends on purchase of dedicated IP?</td>
      <td style="text-align: left">DE, GB, NL, US</td>
    </tr>
    <tr>
      <td>Standard_VPN_servers</td>
      <td style="text-align: center">-</td>
      <td style="text-align: left">AT, AU, BA, BE, BG, CA, CH, CY, CZ, DE, DK, ES, FR, GB, GR, HR, HU, IL, IT, JP, LU, LV, MY, NL, NO, PL, RO, SK, UA, US, VN, ZA</td>
    </tr>
    <tr>
      <td>P2P</td>
      <td style="text-align: center">-</td>
      <td style="text-align: left">AT, AU, BA, BE, BG, CA, CH, CZ, DE, DK, ES, FR, GB, GR, HR, HU, IL, IT, JP, LU, LV, NL, NO, PL, RO, SK, US, ZA</td>
    </tr>
  </tbody>
</table>

<h4 id="regional-groups">Regional groups</h4>

<table>
  <thead>
    <tr>
      <th>Title</th>
      <th style="text-align: center">Countries in region</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Europe</td>
      <td style="text-align: center">AT, BA, BE, CH, CY, CZ, DE, DK, FR, GB, HR, HU, NL, NO, PL, SE</td>
    </tr>
    <tr>
      <td>The_Americas</td>
      <td style="text-align: center">CA, US</td>
    </tr>
    <tr>
      <td>Asia_Pacific</td>
      <td style="text-align: center">AU, HK, ID, JP, MY, NZ, SG, TW, VN</td>
    </tr>
    <tr>
      <td>Africa__the_Middle_East_and_India</td>
      <td style="text-align: center">IL, IN, TR, ZA</td>
    </tr>
  </tbody>
</table>

<h3 id="special-thanks">Special Thanks</h3>

<p>Writing this script would not have been possible without the exquisite <a href="https://blog.sleeplessbeastie.eu/2019/02/18/how-to-use-public-nordvpn-api/">NordVPN API documentation</a> by Milosz Galazka.</p>

<h2 id="installation">Installation</h2>

<p>The script relies on <a href="https://openwrt.org/start">OpenWRT’s</a> (<a href="https://www.busybox.net/downloads/BusyBox.html">BusyBox</a>) built-in <code class="language-plaintext highlighter-rouge">wget</code> and <a href="https://openwrt.org/docs/guide-developer/jshn#jsonfilter"><code class="language-plaintext highlighter-rouge">jsonfilter</code></a>, but depends on several other packages. Check how much free space you have on your device either from LuCI (system -&gt; software) or from shell by running <code class="language-plaintext highlighter-rouge">df</code> and looking at the <code class="language-plaintext highlighter-rouge">/overlay</code> line. You can compare the space left to the list of requirements below.</p>

<ol>
  <li>Follow (if you haven’t already) <a href="https://support.nordvpn.com/Connectivity/Router/1047411192/OpenWRT-CI-setup-with-NordVPN.htm">NordVPN’s guide</a> for setting up OpenVPN on your router, and make sure your router connects to NordVPN’s servers and your internet connection is good.</li>
  <li>Log in to your router’s shell, eg.: <code class="language-plaintext highlighter-rouge">ssh root@192.168.1.1</code>.</li>
  <li>Run the following command on your remote shell to check whether <code class="language-plaintext highlighter-rouge">wget</code> can be used to send <code class="language-plaintext highlighter-rouge">GET</code> requests: <br />
<code class="language-plaintext highlighter-rouge">wget -O - "https://raw.githubusercontent.com/urishx/vpn-profile-switcher/db/countries.tsv"</code></li>
  <li>If you get a table of countries in which NordVPN has servers, you’re all set, skip to the last step to download the script to your router.</li>
  <li>In case the response you you got was: <br />
<code class="language-plaintext highlighter-rouge">wget: SSL support not available, please install one of the libustream-.*[ssl|tls] packages as well as the ca-bundle and ca-certificates packages.</code> <br />
you will need to install <code class="language-plaintext highlighter-rouge">libustream*tls*</code> and its dependencies. - Run <code class="language-plaintext highlighter-rouge">opkg update</code> - Then <code class="language-plaintext highlighter-rouge">opkg list libustream*</code> - Look for <code class="language-plaintext highlighter-rouge">libustream-.*tls.*</code>, copy the package name, and install it by running <code class="language-plaintext highlighter-rouge">opkg install &lt;the-package-name-you-copied&gt;</code>. <br />
 eg.: <code class="language-plaintext highlighter-rouge">opkg install libustream-mbedtls20150806</code> on my TP-Link Archer C20i w/ OpenWRT v19.07.5. - Re-check step 3, to see you now get the table of countries.</li>
  <li>Downloading the script and first run:
    <ul>
      <li>Run <code class="language-plaintext highlighter-rouge">wget https://raw.githubusercontent.com/UriShX/vpn-profile-switcher/main/vpn-profile-switcher.sh</code> to download the script to your router.</li>
      <li>Run <code class="language-plaintext highlighter-rouge">chmod +x vpn-profile-switcher.sh</code>.</li>
      <li>Test the script by running <code class="language-plaintext highlighter-rouge">./vpn-profile-switcher.sh</code>.</li>
    </ul>
  </li>
</ol>

<h3 id="requirements">Requirements</h3>

<ul>
  <li>From NordVPN’s guide (~800 kB with required dependencies):
    <ul>
      <li>openvpn-openssl (~158.4 kB)</li>
      <li>ip-full (~167.4 kB)</li>
      <li>luci-app-openvpn (~12.2 kB)</li>
    </ul>
  </li>
  <li>tls for executing <code class="language-plaintext highlighter-rouge">GET</code> requests using <code class="language-plaintext highlighter-rouge">wget</code> (~180 kB):
    <ul>
      <li>libustream-mbedtls20150806 (~4.5 kB)</li>
      <li>libmbedtls12 (~178 kB)</li>
    </ul>
  </li>
  <li>Switching script, profiles, etc. (~14 kB):
    <ul>
      <li>vpn-profile-switcher.sh (~8 kB)</li>
      <li>2 OpenVPN profile - current and last used (ea. ~2.8)</li>
    </ul>
  </li>
</ul>

<h2 id="usage">Usage</h2>

<p>Run <code class="language-plaintext highlighter-rouge">./vpn-profile-switcher.sh -h</code> to list the available parameters:</p>

<blockquote>
  <p>vpn-profile-switcher.sh v1.0.0 <br />
Get NordVPN recommended profile and set OpenVPN on OpenWRT to use said profile.</p>

  <p>Usage: ./vpn-profile-switcher.sh [options <parameters>]</parameters></p>

  <p>Options: <br />
-h | –help, Print this help message <br />
-p | –protocol &lt; udp | tcp &gt;, Select either UDP or TCP connection. Default is UDP. <br />
-c | –country &lt; code | name &gt;, Select Country to filter by. Default is closest to your location. <br />
-g | –group &lt; group_name &gt;, Select group to filter by. <br />
-l | –login-info &lt; filename &gt;, Specify file for VPN login credentials. Default is ‘secret’.</p>

  <p>For more information see README in repo: https://github.com/UriShX/vpn-profile-switcher</p>
</blockquote>

<h3 id="script-parameters">Script parameters</h3>

<h4 id="-p-or---protocol"><code class="language-plaintext highlighter-rouge">-p</code> or <code class="language-plaintext highlighter-rouge">--protocol</code></h4>

<p>Has to be followed by either <code class="language-plaintext highlighter-rouge">udp</code> or <code class="language-plaintext highlighter-rouge">tcp</code> (lowercase). <br />
Select either UDP or TCP connection. <br />
If protocol is not defined, the script assumes UDP, for a faster (though less secure) connection.</p>

<p>For some details about the up and down sides of both TCP and UDP, see <a href="https://www.fastestvpnguide.com/openvpn-tcp-vs-udp/">this article</a>.</p>

<h4 id="-c-or---country"><code class="language-plaintext highlighter-rouge">-c</code> or <code class="language-plaintext highlighter-rouge">--country</code></h4>

<p>Has to be followed by either the country’s ID, code, or name (ignores case). <br />
Select country to filter by. <br />
Default is closest to your location as determined by NordVPN’s server, so if you are connected to a server which is far from your actual location and do not specify a different location for the script to filter by, your location will be remain in the same location as the server you are connected to.</p>

<p>You can view the list of available countries <a href="https://github.com/UriShX/vpn-profile-switcher/blob/db/countries.tsv">here</a>.</p>

<h4 id="-g-or---group"><code class="language-plaintext highlighter-rouge">-g</code> or <code class="language-plaintext highlighter-rouge">--group</code></h4>

<p>Has to be followed by desired server group’s ID, identifier, or title. <br />
Select group to filter by. <br />
Unlike the <code class="language-plaintext highlighter-rouge">--country</code> filter, the group has to be specified with every request. According to NordVPN’s documentation, <a href="https://support.nordvpn.com/General-info/Features/1047407792/Peer-to-Peer-P2P-traffic-with-NordVPN.htm">connecting to P2P services</a> will be re-routed through either Canada or Holland, while <a href="https://support.nordvpn.com/General-info/Features/1047408202/What-is-Onion-over-VPN-and-how-can-I-use-it.htm">Onion over VPN</a> is only available through specific servers. <br />
In short - the default server to which you will be will most likely be a standard server. Read more <a href="https://support.nordvpn.com/General-info/Features/1047407962/What-do-the-different-server-categories-mean.htm">here</a>.</p>

<p>You can view the list of available server groups <a href="https://github.com/UriShX/vpn-profile-switcher/blob/db/server-groups.tsv">here</a>.</p>

<h4 id="-l-or---login-info"><code class="language-plaintext highlighter-rouge">-l</code> or <code class="language-plaintext highlighter-rouge">--login-info</code></h4>

<p>Has to be followed by filename. <br />
Specify file for VPN login credentials. <br />
Default is ‘secret’, as in NordVPN’s <a href="https://support.nordvpn.com/Connectivity/Router/1047411192/OpenWRT-CI-setup-with-NordVPN.htm">guide</a> for setting a connection with OpenWRT over OpenVPN.</p>

<h2 id="examples">Examples</h2>

<h3 id="from-cli">From CLI</h3>

<h4 id="connect-to-a-recommended-peer-to-peer-p2p-server-in-the-united-states-over-udp-default-protocol">Connect to a recommended Peer to Peer (P2P) server in the United States over UDP (default protocol)</h4>

<pre><code class="language-root"># ./vpn-profile-switcher.sh -c US -g p2p
</code></pre>

<p>Output:</p>

<blockquote>
  <p>root: (./vpn-profile-switcher.sh) Arguments: Protocol: udp; Country: 228; NordVPN group: legacy_p2p; User credentials: secret. <br />
root: (./vpn-profile-switcher.sh) Fetching VPN recommendations from: https://api.nordvpn.com/v1/servers/recommendations?filters[servers_groups][identifier]=legacy_p2p&amp;filters[country_id]=228&amp;filters[servers_technologies][identifier]=openvpn_udp&amp;limit=1 <br />
root: (./vpn-profile-switcher.sh) Recommended server URL: us6739.nordvpn.com. <br />
root: (./vpn-profile-switcher.sh) Fetching OpenVPN config us6739.nordvpn.com.udp.ovpn, and setting credentials pointing to: secret <br />
root: (./vpn-profile-switcher.sh) Entered new entry to OpenVPN configs: us6739_nordvpn_udp <br />
root: (./vpn-profile-switcher.sh) Currently active server: cy14_nordvpn_udp <br />
root: (./vpn-profile-switcher.sh) Enabling new entry <br />
root: (./vpn-profile-switcher.sh) Disabling current active server <br />
root: (./vpn-profile-switcher.sh) Comitting changes and restarting OpenVPN <br />
root: (./vpn-profile-switcher.sh) Removing unused NordVPN profiles, leaving current and last used.</p>
</blockquote>

<h4 id="connect-to-a-standard-vpn-server-in-argentina-over-tcp">Connect to a standard VPN server in Argentina over TCP</h4>

<pre><code class="language-root"># ./vpn-profile-switcher.sh -c 10 -p tcp
</code></pre>

<h4 id="connect-to-a-standard-vpn-server-in-israel-over-udp-default-protocol">Connect to a standard VPN server in Israel over UDP (default protocol)</h4>

<pre><code class="language-root"># ./vpn-profile-switcher.sh -c israel
</code></pre>

<h4 id="connect-to-a-recommended-vpn-server-in-north-america-usa-and-canada-over-udp-default-protocol">Connect to a recommended VPN server in North America (USA and Canada) over UDP (default protocol)</h4>

<pre><code class="language-root"># ./vpn-profile-switcher.sh -g the_americas
</code></pre>

<h3 id="scheduling-with-crontab">Scheduling with <a href="https://openwrt.org/docs/guide-user/base-system/cron">crontab</a></h3>

<p>It is possible to use crontab for maintaining a connection to a recommended server. In this basic example, the script runs once an hour (at a round hour) to get the recommended server in the area the router is connected to, over UDP (default protocol).</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0 <span class="k">*</span>/1 <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> /root/vpn-profile-switcher.sh
</code></pre></div></div>

<p>The output will be displayed in the system log, like so:</p>

<blockquote>
  <p>Wed Jan 13 23:02:00 2021 cron.info crond[22011]: USER root pid 22868 cmd /root/vpn-profile-switcher.sh <br />
Wed Jan 13 23:02:00 2021 user.notice root: (/root/vpn-profile-switcher.sh) Arguments: Protocol: udp; Country: ; NordVPN group: ; User credentials: secret. <br />
Wed Jan 13 23:02:00 2021 user.notice root: (/root/vpn-profile-switcher.sh) Fetching VPN recommendations from: https://api.nordvpn.com/v1/servers/recommendations?filters[servers_technologies][identifier]=openvpn_udp&amp;limit=1 <br />
Wed Jan 13 23:02:10 2021 user.notice root: (/root/vpn-profile-switcher.sh) Recommended server URL: il52.nordvpn.com. <br />
Wed Jan 13 23:02:10 2021 user.notice root: (/root/vpn-profile-switcher.sh) Recommended server name: il52_nordvpn_udp <br />
Wed Jan 13 23:02:10 2021 user.notice root: (/root/vpn-profile-switcher.sh) Currently active server: il38_nordvpn_udp <br />
Wed Jan 13 23:02:10 2021 user.notice root: (/root/vpn-profile-switcher.sh) Enabling existing entry <br />
Wed Jan 13 23:02:10 2021 user.notice root: (/root/vpn-profile-switcher.sh) Disabling current active server <br />
Wed Jan 13 23:02:10 2021 user.notice root: (/root/vpn-profile-switcher.sh) Comitting changes and restarting OpenVPN</p>
</blockquote>

<p>Using crontab, it is possible to set connection to different countries, groups, and over either UDP or TCP by scheduling running the script with different parameters. Check out both OpenWRT’s <a href="https://openwrt.org/docs/guide-user/base-system/cron">crontab</a> documentation, and <a href="https://crontab.guru/">crontab guru</a> for more details.</p>

<p>In any case, <strong><em>don’t forget to run <code class="language-plaintext highlighter-rouge">/etc/init.d/cron restart</code> to apply changes</em></strong></p>

<h2 id="contributing">Contributing</h2>

<p>Bug reports and pull requests are welcome on GitHub at https://github.com/UriShX/vpn-profile-switcher.</p>

<h2 id="license">License</h2>

<p>The script is available as open source under the terms of the <a href="https://github.com/UriShX/vpn-profile-switcher/blob/main/LICENSE">MIT License</a>.</p>

                        
                    </div>
                    <footer>
                        <p>
                            
                            <a class="js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                                title="Close this modal">Back</a>
                            
                        </p>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">&times;</a>
            </section>
            
            

            
            
            <section aria-hidden="true" aria-labelledby="modal-label" class="portfolio-modal modal--gallery"
                data-cssmodal-resize="true" id="modal-gallery-18" role="dialog" tabindex="-1">
                <div class="modal-inner">
                    <div class="modal-content">
                        <div class="spinner">
                            <div class="spinner__outer"></div>
                            <div class="spinner__inner"></div>
                        </div>


                        <div aria-atomic="false" aria-live="polite" class="modal-detail"></div>

                        <ul class="modal--gallery-navigation">
                            <li>
                                <a class="modal--gallery-navigation-prev" href="#" title="Previous">Previous</a>
                            </li>
                            <li>
                                <a class="modal--gallery-navigation-next" href="#" title="Next">Next</a>
                            </li>
                        </ul>

                    </div>
                    <div class="modal--gallery-caption"></div>

                    <footer>
                        <ul aria-hidden="true" class="modal-content-list is-active">
                            
                            
                            <li data-caption="">
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#stackable-18-2">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/twotone_description_black_48pt_3x.png">
                                </a>
                                
                            </li>
                            
                            
                            
                        </ul>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">?</a>
            </section>
            
        </div>
        
        
        
        
        
        <div class="portfolio-block portfolio-l plastics-engineering elastomer injection-molding cad mechanical "
            id="portfolio-block-19">
            <div class="portfolio-front"
                style="background-image: url('/assets/img/portfolio/aerial-warning-ball/warning-ball-test-768x432.jpg');">
            </div>
            <div class="portfolio-overlay"></div>
            <div class="portfolio-excerpt">
                
                <h3>Design for plastic injection molding: UAV fuel tank.</h3>
                
                <p>
                    
                    Design change in a flagship product, fueled by failure analysis. Lead engineer, salaried work for “Supergum”.
Mold and material change for high current aerial warning marker, after appearing to be part of a point failure. A comprehensive failure analysis, and mechanical testing of the new design lead to verified changes.

                </p>
            </div>
            <div class="portflio-links">
                
                
                
                <a href="#modal-gallery-19">
                    <i class="material-icons">pageview</i>
                </a>
                
                
            </div>


            

            
            
            
            
            
            
            
            
            

            
            
            <section aria-hidden="true" aria-labelledby="modal-label" class="portfolio-modal modal--gallery"
                data-cssmodal-resize="true" id="modal-gallery-19" role="dialog" tabindex="-1">
                <div class="modal-inner">
                    <div class="modal-content">
                        <div class="spinner">
                            <div class="spinner__outer"></div>
                            <div class="spinner__inner"></div>
                        </div>


                        <div aria-atomic="false" aria-live="polite" class="modal-detail"></div>

                        <ul class="modal--gallery-navigation">
                            <li>
                                <a class="modal--gallery-navigation-prev" href="#" title="Previous">Previous</a>
                            </li>
                            <li>
                                <a class="modal--gallery-navigation-next" href="#" title="Next">Next</a>
                            </li>
                        </ul>

                    </div>
                    <div class="modal--gallery-caption"></div>

                    <footer>
                        <ul aria-hidden="true" class="modal-content-list is-active">
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-19/1">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/aerial-warning-ball/warning-ball-test-768x432.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-19/2">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/aerial-warning-ball/warning-ball-change-drawing-768x406.png">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-19/3">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/aerial-warning-ball/1182_f11269c96d3b4fcf65e73279e52cef6b.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-19/4">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/aerial-warning-ball/warning-ball-lips-closed-768x490.png">
                                </a>
                                
                            </li>
                            
                            
                            
                        </ul>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">?</a>
            </section>
            
        </div>
        
        
        
        
        
        <div class="portfolio-block portfolio-r cae design model "
            id="portfolio-block-20">
            <div class="portfolio-front"
                style="background-image: url('/assets/img/portfolio/ziv-foot-rest/2nd_iteration_rounded_handle_vonMises-768x432.png');">
            </div>
            <div class="portfolio-overlay"></div>
            <div class="portfolio-excerpt">
                
                <h3>Static forces analysis for heat formed foot-rest</h3>
                
                <p>
                    
                    Stress and strain validation of a heat formed foot-rest concept. Design by Ziv Mishan, for his graduation project in product design at H.I.T.. Characterization of applied forces, appropriate model, and several iterations based on slight changes in geometry, based on client’s original design file. A report was produced to convey suggested changes in design.

                </p>
            </div>
            <div class="portflio-links">
                
                
                
                <a href="#modal-gallery-20">
                    <i class="material-icons">pageview</i>
                </a>
                
                
            </div>


            

            
            
            
            
            
            
            
            
            

            
            
            <section aria-hidden="true" aria-labelledby="modal-label" class="portfolio-modal modal--gallery"
                data-cssmodal-resize="true" id="modal-gallery-20" role="dialog" tabindex="-1">
                <div class="modal-inner">
                    <div class="modal-content">
                        <div class="spinner">
                            <div class="spinner__outer"></div>
                            <div class="spinner__inner"></div>
                        </div>


                        <div aria-atomic="false" aria-live="polite" class="modal-detail"></div>

                        <ul class="modal--gallery-navigation">
                            <li>
                                <a class="modal--gallery-navigation-prev" href="#" title="Previous">Previous</a>
                            </li>
                            <li>
                                <a class="modal--gallery-navigation-next" href="#" title="Next">Next</a>
                            </li>
                        </ul>

                    </div>
                    <div class="modal--gallery-caption"></div>

                    <footer>
                        <ul aria-hidden="true" class="modal-content-list is-active">
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-20/1">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/ziv-foot-rest/2nd_iteration_rounded_handle_vonMises-768x432.png">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-20/2">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/ziv-foot-rest/1st_iteration_displacement-768x432.png">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-20/3">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/ziv-foot-rest/ziv-stool-03-578x1024.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-20/4">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/ziv-foot-rest/ziv-stool-01-768x576.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                        </ul>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">?</a>
            </section>
            
        </div>
        
        
        
        
        
        <div class="portfolio-block portfolio-l plastics-engineering "
            id="portfolio-block-21">
            <div class="portfolio-front"
                style="background-image: url('/assets/img/portfolio/sus-comp-agriwaste/dual-extruder-straw.jpg');">
            </div>
            <div class="portfolio-overlay"></div>
            <div class="portfolio-excerpt">
                
                <h3>Sustainable composites from agricultural waste</h3>
                
                <p>
                    
                    Scientific article, published in “Polymer Composites”. Based on my plastics engineering graduation project at Shenkar College for engineering and Design.

                </p>
            </div>
            <div class="portflio-links">
                
                <a href="https://onlinelibrary.wiley.com/doi/abs/10.1002/pc.24472" target="_blank" rel="noopener noreferrer">
                    <i class="material-icons">link</i>
                </a>
                
                
                
                <a href="#modal-gallery-21">
                    <i class="material-icons">pageview</i>
                </a>
                
                
            </div>


            

            
            
            
            
            
            
            

            
            
            <section aria-hidden="true" aria-labelledby="modal-label" class="portfolio-modal modal--gallery"
                data-cssmodal-resize="true" id="modal-gallery-21" role="dialog" tabindex="-1">
                <div class="modal-inner">
                    <div class="modal-content">
                        <div class="spinner">
                            <div class="spinner__outer"></div>
                            <div class="spinner__inner"></div>
                        </div>


                        <div aria-atomic="false" aria-live="polite" class="modal-detail"></div>

                        <ul class="modal--gallery-navigation">
                            <li>
                                <a class="modal--gallery-navigation-prev" href="#" title="Previous">Previous</a>
                            </li>
                            <li>
                                <a class="modal--gallery-navigation-next" href="#" title="Next">Next</a>
                            </li>
                        </ul>

                    </div>
                    <div class="modal--gallery-caption"></div>

                    <footer>
                        <ul aria-hidden="true" class="modal-content-list is-active">
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-21/1">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/sus-comp-agriwaste/Poster-straw-pp-composites-768x1097.png">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-21/2">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/sus-comp-agriwaste/filtration.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-21/3">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/sus-comp-agriwaste/dual-extruder-straw.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                        </ul>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">?</a>
            </section>
            
        </div>
        
        
        
        
        
        <div class="portfolio-block portfolio-r model "
            id="portfolio-block-22">
            <div class="portfolio-front"
                style="background-image: url('/assets/img/portfolio/acoustic-guitar/IMG_0810-768x576.jpg');">
            </div>
            <div class="portfolio-overlay"></div>
            <div class="portfolio-excerpt">
                
                <h3>Acoustic guitar</h3>
                
                <p>
                    
                    Hand built acoustic guitar. Designed and built by me during my studies with Paul Doyle at The Irish School of Lutherie. 
Top - Spruce. Back and Sides - Maple. Neck - London Plain.

                </p>
            </div>
            <div class="portflio-links">
                
                
                
                <a href="#modal-gallery-22">
                    <i class="material-icons">pageview</i>
                </a>
                
                
            </div>


            

            
            
            
            
            
            
            
            
            

            
            
            <section aria-hidden="true" aria-labelledby="modal-label" class="portfolio-modal modal--gallery"
                data-cssmodal-resize="true" id="modal-gallery-22" role="dialog" tabindex="-1">
                <div class="modal-inner">
                    <div class="modal-content">
                        <div class="spinner">
                            <div class="spinner__outer"></div>
                            <div class="spinner__inner"></div>
                        </div>


                        <div aria-atomic="false" aria-live="polite" class="modal-detail"></div>

                        <ul class="modal--gallery-navigation">
                            <li>
                                <a class="modal--gallery-navigation-prev" href="#" title="Previous">Previous</a>
                            </li>
                            <li>
                                <a class="modal--gallery-navigation-next" href="#" title="Next">Next</a>
                            </li>
                        </ul>

                    </div>
                    <div class="modal--gallery-caption"></div>

                    <footer>
                        <ul aria-hidden="true" class="modal-content-list is-active">
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-22/1">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/acoustic-guitar/IMG_0809-768x576.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-22/2">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/acoustic-guitar/Guitar-head-768x1024.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-22/3">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/acoustic-guitar/Guitar-from-top-649x1024.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-22/4">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/acoustic-guitar/IMG_0810-768x576.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                        </ul>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">?</a>
            </section>
            
        </div>
        
        
        
        
        
        <div class="portfolio-block portfolio-l design prototype "
            id="portfolio-block-23">
            <div class="portfolio-front"
                style="background-image: url('/assets/img/portfolio/tannerino/Tannerino-design-concept-1024x728.jpg');">
            </div>
            <div class="portfolio-overlay"></div>
            <div class="portfolio-excerpt">
                
                <h3>Tannerino (electro-Theremin)</h3>
                
                <p>
                    
                    A continuous variable frequency MIDI controller based on an Arduino Uno.

                </p>
            </div>
            <div class="portflio-links">
                
                <a href="https://hackaday.io/project/133879-tannerino" target="_blank" rel="noopener noreferrer">
                    <i class="material-icons">link</i>
                </a>
                
                
                
                <a href="#modal-gallery-23">
                    <i class="material-icons">pageview</i>
                </a>
                
                
            </div>


            

            
            
            

            
            
            <section aria-hidden="true" aria-labelledby="modal-label" class="portfolio-modal modal--gallery"
                data-cssmodal-resize="true" id="modal-gallery-23" role="dialog" tabindex="-1">
                <div class="modal-inner">
                    <div class="modal-content">
                        <div class="spinner">
                            <div class="spinner__outer"></div>
                            <div class="spinner__inner"></div>
                        </div>


                        <div aria-atomic="false" aria-live="polite" class="modal-detail"></div>

                        <ul class="modal--gallery-navigation">
                            <li>
                                <a class="modal--gallery-navigation-prev" href="#" title="Previous">Previous</a>
                            </li>
                            <li>
                                <a class="modal--gallery-navigation-next" href="#" title="Next">Next</a>
                            </li>
                        </ul>

                    </div>
                    <div class="modal--gallery-caption"></div>

                    <footer>
                        <ul aria-hidden="true" class="modal-content-list is-active">
                            
                            
                            <li data-caption="">
                                
                                <a href="#modal-gallery-23/1">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/tannerino/Tannerino-design-concept-1024x728.jpg">
                                </a>
                                
                            </li>
                            
                            
                            
                        </ul>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">?</a>
            </section>
            
        </div>
        
        
        
        
        
        <div class="portfolio-block portfolio-r ruby code web limited-hover"
            id="portfolio-block-24">
            <div class="portfolio-front"
                style="background-image: url('/assets/img/logo_code.png');">
            </div>
            <div class="portfolio-overlay"></div>
            <div class="portfolio-excerpt">
                
                <h3>Jekyll plugin for passing vars to {% highlight %} tag</h3>
                
                <p>
                    
                    A Jekyll plugin for passing variables to the {% highlight %} Liquid tag.

                </p>
            </div>
            <div class="portflio-links">
                
                <a href="https://rubygems.org/gems/jekyll-highlight-param" target="_blank" rel="noopener noreferrer">
                    <i class="material-icons">link</i>
                </a>
                
                
                
                <a href="#stackable-24-1">
                    <i class="material-icons">pageview</i>
                </a>
                
                
            </div>


            

            
            
            <section aria-hidden="true" aria-labelledby="stackable-label" class="modal--show"
                id="stackable-24-1" role="dialog" tabindex="-1">

                <div class="modal-inner">
                    <header>
                        
                        <h2 id="stackable-label">Code: ruby</h2>
                        
                    </header>
                    <div class="modal-content">
                        
                        
                        
                        
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">                        <span class="c1"># frozen_string_literal: true</span>

<span class="k">module</span> <span class="nn">Jekyll</span>
  <span class="k">module</span> <span class="nn">Tags</span>
    <span class="k">class</span> <span class="nc">HighlightBlockParam</span> <span class="o">&lt;</span> <span class="no">Liquid</span><span class="o">::</span><span class="no">Block</span>
      <span class="kp">include</span> <span class="no">Liquid</span><span class="o">::</span><span class="no">StandardFilters</span>

      <span class="c1"># The regular expression syntax checker. Start with the language specifier.</span>
      <span class="c1"># Follow that by zero or more space separated options that take one of three</span>
      <span class="c1"># forms: name, name=value, or name="&lt;quoted list&gt;"</span>
      <span class="c1">#</span>
      <span class="c1"># &lt;quoted list&gt; is a space-separated list of numbers</span>
      <span class="c1"># </span>
      <span class="c1"># Both the language specifier and the options can be passed as liquid variables,</span>
      <span class="c1"># please consult the documentation at https://github.com/UriShX/jekyll-highlight-param/blob/master/README.md#usage.</span>
      <span class="no">PARAM_SYNTAX</span> <span class="o">=</span> <span class="sr">%r!(</span><span class="se">\w</span><span class="sr">+([.]</span><span class="se">\w</span><span class="sr">+)*)!x</span><span class="p">.</span><span class="nf">freeze</span>
      <span class="no">LANG_SYNTAX</span> <span class="o">=</span> <span class="sr">%r!([a-zA-Z0-9.+#_-]+)!x</span><span class="p">.</span><span class="nf">freeze</span>
      <span class="no">OPTIONS_SYNTAX</span> <span class="o">=</span> <span class="sr">%r!(</span><span class="se">\s</span><span class="sr">+</span><span class="se">\w</span><span class="sr">+(=(</span><span class="se">\w</span><span class="sr">+|"([0-9]+</span><span class="se">\s</span><span class="sr">)*[0-9]+")?)*)!</span><span class="err">.fr</span><span class="sr">ee</span><span class="n">ze</span>
      <span class="no">VARIABLE_SYNTAX</span> <span class="o">=</span> <span class="sr">%r!
        ^(
          </span><span class="se">\{\{\s</span><span class="sr">*
          (?&lt;lang_var&gt;</span><span class="si">#{</span><span class="no">PARAM_SYNTAX</span><span class="si">}</span><span class="sr">)
          </span><span class="se">\s</span><span class="sr">*</span><span class="se">\}\}</span><span class="sr">|
          (?&lt;lang&gt;</span><span class="si">#{</span><span class="no">LANG_SYNTAX</span><span class="si">}</span><span class="sr">)
        )
        </span><span class="se">\s</span><span class="sr">*
        ((?&lt;fault1&gt;[}]+</span><span class="se">\s</span><span class="sr">*|)
        (
          </span><span class="se">\{\{\s</span><span class="sr">*
          (?&lt;params_var&gt;(</span><span class="si">#{</span><span class="no">PARAM_SYNTAX</span><span class="si">}</span><span class="sr">))
          </span><span class="se">\s</span><span class="sr">*</span><span class="se">\}\}</span><span class="sr">|
          (?&lt;params&gt;(</span><span class="si">#{</span><span class="no">OPTIONS_SYNTAX</span><span class="si">}</span><span class="sr">+))
        )
        (?&lt;fault2&gt;.*))?
      !mx</span><span class="p">.</span><span class="nf">freeze</span>

      <span class="k">def</span> <span class="nf">isNilOrEmpty</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">var</span><span class="p">.</span><span class="nf">nil?</span>
          <span class="k">return</span> <span class="kp">true</span>
        <span class="k">elsif</span> <span class="n">var</span><span class="p">.</span><span class="nf">strip</span><span class="p">.</span><span class="nf">empty?</span>
          <span class="k">return</span> <span class="kp">true</span>
        <span class="k">else</span>
          <span class="k">return</span> <span class="kp">false</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">tag_name</span><span class="p">,</span> <span class="n">markup</span><span class="p">,</span> <span class="n">tokens</span><span class="p">)</span>
        <span class="k">super</span>
        <span class="n">markup</span>  <span class="o">=</span> <span class="n">markup</span><span class="p">.</span><span class="nf">strip</span>
        <span class="vi">@matched</span> <span class="o">=</span> <span class="n">markup</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="no">VARIABLE_SYNTAX</span><span class="p">)</span>
        <span class="c1"># print @matched.captures.to_s + "\n"</span>
        <span class="k">if</span> <span class="o">!</span><span class="vi">@matched</span> <span class="n">or</span> <span class="o">!</span><span class="n">isNilOrEmpty</span><span class="p">(</span><span class="vi">@matched</span><span class="p">[</span><span class="s2">"fault1"</span><span class="p">])</span> <span class="n">or</span> <span class="o">!</span><span class="n">isNilOrEmpty</span><span class="p">(</span><span class="vi">@matched</span><span class="p">[</span><span class="s2">"fault2"</span><span class="p">])</span>
          <span class="k">raise</span> <span class="no">SyntaxError</span><span class="p">,</span> <span class="o">&lt;&lt;~</span><span class="no">MSG</span><span class="sh">
            Syntax Error in tag '</span><span class="si">#{</span><span class="n">tag_name</span><span class="si">}</span><span class="sh">' while parsing the following markup:

            </span><span class="si">#{</span><span class="n">markup</span><span class="si">}</span><span class="sh">

            Valid syntax: </span><span class="si">#{</span><span class="n">tag_name</span><span class="si">}</span><span class="sh"> &lt;lang&gt; [linenos]
                      </span><span class="se">\t</span><span class="sh">OR: </span><span class="si">#{</span><span class="n">tag_name</span><span class="si">}</span><span class="sh"> {{ lang_variable }} [linenos]
                      </span><span class="se">\t</span><span class="sh">OR: </span><span class="si">#{</span><span class="n">tag_name</span><span class="si">}</span><span class="sh"> &lt;lang&gt; {{ [linenos_variable(s)] }}
                      </span><span class="se">\t</span><span class="sh">OR: </span><span class="si">#{</span><span class="n">tag_name</span><span class="si">}</span><span class="sh"> {{ lang_variable }} {{ [linenos_variable(s)] }}
</span><span class="no">          MSG</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="no">LEADING_OR_TRAILING_LINE_TERMINATORS</span> <span class="o">=</span> <span class="sr">%r!</span><span class="se">\A</span><span class="sr">(</span><span class="se">\n</span><span class="sr">|</span><span class="se">\r</span><span class="sr">)+|(</span><span class="se">\n</span><span class="sr">|</span><span class="se">\r</span><span class="sr">)+</span><span class="se">\z</span><span class="sr">!</span><span class="err">.fr</span><span class="sr">ee</span><span class="n">ze</span>

      <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s2">"highlighter_prefix"</span><span class="p">]</span> <span class="o">||</span> <span class="s2">""</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s2">"highlighter_suffix"</span><span class="p">]</span> <span class="o">||</span> <span class="s2">""</span>
        <span class="n">code</span> <span class="o">=</span> <span class="k">super</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="no">LEADING_OR_TRAILING_LINE_TERMINATORS</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>

        <span class="k">if</span> <span class="vi">@matched</span><span class="p">[</span><span class="s2">"lang_var"</span><span class="p">]</span>
          <span class="vi">@lang</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="vi">@matched</span><span class="p">[</span><span class="s2">"lang_var"</span><span class="p">]].</span><span class="nf">downcase</span>
          <span class="vi">@lang</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="no">LANG_SYNTAX</span><span class="p">)</span>
          <span class="k">unless</span> <span class="vg">$&amp;</span> <span class="o">==</span> <span class="vi">@lang</span>
            <span class="k">raise</span> <span class="no">ArgumentError</span><span class="p">,</span> <span class="o">&lt;&lt;~</span><span class="no">MSG</span><span class="sh">
              Language characters can only include Alphanumeric and the following characters, without spaces: . + # _ -
              Your passed language variable: </span><span class="si">#{</span><span class="vi">@lang</span><span class="si">}</span><span class="sh">
</span><span class="no">              MSG</span>
          <span class="k">end</span>
        <span class="k">elsif</span> <span class="vi">@matched</span><span class="p">[</span><span class="s2">"lang"</span><span class="p">]</span>
          <span class="vi">@lang</span> <span class="o">=</span> <span class="vi">@matched</span><span class="p">[</span><span class="s2">"lang"</span><span class="p">].</span><span class="nf">downcase</span>
        <span class="k">else</span>
          <span class="k">raise</span> <span class="no">SyntaxError</span><span class="p">,</span> <span class="o">&lt;&lt;~</span><span class="no">MSG</span><span class="sh">
            Unknown Syntax Error in tag 'highlight_param'.
            Please review tag documentation.
</span><span class="no">            MSG</span>
        <span class="k">end</span>

        <span class="c1"># puts @lang</span>

        <span class="k">if</span> <span class="vi">@matched</span><span class="p">[</span><span class="s2">"params_var"</span><span class="p">]</span>
          <span class="vi">@highlight_options</span> <span class="o">=</span> <span class="n">parse_options</span><span class="p">(</span><span class="vi">@matched</span><span class="p">[</span><span class="s2">"params_var"</span><span class="p">])</span>
        <span class="k">elsif</span> <span class="vi">@matched</span><span class="p">[</span><span class="s2">"params"</span><span class="p">]</span>
          <span class="vi">@highlight_options</span> <span class="o">=</span> <span class="n">parse_options</span><span class="p">(</span><span class="vi">@matched</span><span class="p">[</span><span class="s2">"params"</span><span class="p">])</span>
        <span class="k">else</span>
          <span class="vi">@highlight_options</span> <span class="o">=</span> <span class="n">parse_options</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span>
        <span class="k">end</span>

        <span class="c1"># puts @highlight_options</span>

        <span class="n">output</span> <span class="o">=</span>
          <span class="k">case</span> <span class="n">context</span><span class="p">.</span><span class="nf">registers</span><span class="p">[</span><span class="ss">:site</span><span class="p">].</span><span class="nf">highlighter</span>
          <span class="k">when</span> <span class="s2">"rouge"</span>
            <span class="n">render_rouge</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
          <span class="k">when</span> <span class="s2">"pygments"</span>
            <span class="n">render_pygments</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
          <span class="k">else</span>
            <span class="n">render_codehighlighter</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
          <span class="k">end</span>

        <span class="n">rendered_output</span> <span class="o">=</span> <span class="n">add_code_tag</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="n">prefix</span> <span class="o">+</span> <span class="n">rendered_output</span> <span class="o">+</span> <span class="n">suffix</span>
      <span class="k">end</span>

      <span class="kp">private</span>

      <span class="no">OPTIONS_REGEX</span> <span class="o">=</span> <span class="sr">%r!(?:</span><span class="se">\w</span><span class="sr">="[^"]*"|</span><span class="se">\w</span><span class="sr">=</span><span class="se">\w</span><span class="sr">|</span><span class="se">\w</span><span class="sr">)+!</span><span class="err">.fr</span><span class="sr">ee</span><span class="n">ze</span>

      <span class="k">def</span> <span class="nf">parse_options</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">options</span> <span class="k">if</span> <span class="n">isNilOrEmpty</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>

        <span class="c1"># Split along 3 possible forms -- key="&lt;quoted list&gt;", key=value, or key</span>
        <span class="n">input</span><span class="p">.</span><span class="nf">scan</span><span class="p">(</span><span class="no">OPTIONS_REGEX</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">opt</span><span class="o">|</span>
          <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">opt</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s2">"="</span><span class="p">)</span>
          <span class="c1"># If a quoted list, convert to array</span>
          <span class="k">if</span> <span class="n">value</span><span class="o">&amp;</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="s1">'"'</span><span class="p">)</span>
            <span class="n">value</span><span class="p">.</span><span class="nf">delete!</span><span class="p">(</span><span class="s1">'"'</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">.</span><span class="nf">split</span>
          <span class="k">end</span>
          <span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">.</span><span class="nf">to_sym</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="o">||</span> <span class="kp">true</span>
        <span class="k">end</span>

        <span class="n">options</span><span class="p">[</span><span class="ss">:linenos</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"inline"</span> <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="ss">:linenos</span><span class="p">]</span> <span class="o">==</span> <span class="kp">true</span>
        <span class="n">options</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">render_pygments</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">_context</span><span class="p">)</span>
        <span class="no">Jekyll</span><span class="p">.</span><span class="nf">logger</span><span class="p">.</span><span class="nf">warn</span> <span class="s2">"Warning:"</span><span class="p">,</span> <span class="s2">"Highlight Tag no longer supports rendering with Pygments."</span>
        <span class="no">Jekyll</span><span class="p">.</span><span class="nf">logger</span><span class="p">.</span><span class="nf">warn</span> <span class="s2">""</span><span class="p">,</span> <span class="s2">"Using the default highlighter, Rouge, instead."</span>
        <span class="n">render_rouge</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">render_rouge</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="nb">require</span> <span class="s2">"rouge"</span>
        <span class="n">formatter</span> <span class="o">=</span> <span class="o">::</span><span class="no">Rouge</span><span class="o">::</span><span class="no">Formatters</span><span class="o">::</span><span class="no">HTMLLegacy</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span>
          <span class="ss">:line_numbers</span> <span class="o">=&gt;</span> <span class="vi">@highlight_options</span><span class="p">[</span><span class="ss">:linenos</span><span class="p">],</span>
          <span class="ss">:wrap</span>         <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">,</span>
          <span class="ss">:css_class</span>    <span class="o">=&gt;</span> <span class="s2">"highlight"</span><span class="p">,</span>
          <span class="ss">:gutter_class</span> <span class="o">=&gt;</span> <span class="s2">"gutter"</span><span class="p">,</span>
          <span class="ss">:code_class</span>   <span class="o">=&gt;</span> <span class="s2">"code"</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="no">LANG_SYNTAX</span><span class="p">.</span><span class="nf">match?</span><span class="p">(</span><span class="vi">@lang</span><span class="p">)</span>
          <span class="n">lexer</span> <span class="o">=</span> <span class="o">::</span><span class="no">Rouge</span><span class="o">::</span><span class="no">Lexer</span><span class="p">.</span><span class="nf">find_fancy</span><span class="p">(</span><span class="vi">@lang</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span> <span class="o">||</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">PlainText</span>
        <span class="k">else</span>
          <span class="k">raise</span> <span class="no">SyntaxError</span><span class="p">,</span> <span class="o">&lt;&lt;~</span><span class="no">MSG</span><span class="sh">
          Can't find language variable </span><span class="si">#{</span><span class="vi">@matched</span><span class="p">[</span><span class="s2">"lang_var"</span><span class="p">]</span><span class="si">}</span><span class="sh">
</span><span class="no">          MSG</span>
        <span class="k">end</span>
        <span class="n">formatter</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">lexer</span><span class="p">.</span><span class="nf">lex</span><span class="p">(</span><span class="n">code</span><span class="p">))</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">render_codehighlighter</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="n">h</span><span class="p">(</span><span class="n">code</span><span class="p">).</span><span class="nf">strip</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">add_code_tag</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="n">code_attributes</span> <span class="o">=</span> <span class="p">[</span>
          <span class="s2">"class=</span><span class="se">\"</span><span class="s2">language-</span><span class="si">#{</span><span class="vi">@lang</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">tr</span><span class="p">(</span><span class="s2">"+"</span><span class="p">,</span> <span class="s2">"-"</span><span class="p">)</span><span class="si">}</span><span class="se">\"</span><span class="s2">"</span><span class="p">,</span>
          <span class="s2">"data-lang=</span><span class="se">\"</span><span class="si">#{</span><span class="vi">@lang</span><span class="si">}</span><span class="se">\"</span><span class="s2">"</span><span class="p">,</span>
        <span class="p">].</span><span class="nf">join</span><span class="p">(</span><span class="s2">" "</span><span class="p">)</span>
        <span class="s2">"&lt;figure class=</span><span class="se">\"</span><span class="s2">highlight</span><span class="se">\"</span><span class="s2">&gt;&lt;pre&gt;&lt;code </span><span class="si">#{</span><span class="n">code_attributes</span><span class="si">}</span><span class="s2">&gt;"</span><span class="p">\</span>
        <span class="s2">"</span><span class="si">#{</span><span class="n">code</span><span class="p">.</span><span class="nf">chomp</span><span class="si">}</span><span class="s2">&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;"</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Liquid</span><span class="o">::</span><span class="no">Template</span><span class="p">.</span><span class="nf">register_tag</span><span class="p">(</span><span class="s2">"highlight_param"</span><span class="p">,</span> <span class="no">Jekyll</span><span class="o">::</span><span class="no">Tags</span><span class="o">::</span><span class="no">HighlightBlockParam</span><span class="p">)</span>
                        </code></pre></figure>

                        
                        
                    </div>
                    <footer>
                        <p>
                            
                            
                            
                            <a class="open-modal" href="#modal-gallery-24" role="button"
                                title="Open gallery modal">Open image gallery</a>
                            
                            
                        </p>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">&times;</a>
            </section>
            
            
            
            <section aria-hidden="true" aria-labelledby="stackable-label" class="modal--show"
                id="stackable-24-2" role="dialog" tabindex="-1">

                <div class="modal-inner">
                    <header>
                        
                        <h2 id="stackable-label">Markdown / Readme</h2>
                        
                    </header>
                    <div class="modal-content">
                        
                        
                        <h1 id="jekyll-highlight-param">jekyll-highlight-param</h1>

<p><a href="https://badge.fury.io/rb/jekyll-highlight-param"><img src="https://badge.fury.io/rb/jekyll-highlight-param.svg" alt="Gem Version" /></a></p>

<p>A Liquid tag plugin for Jekyll that replaces the built in <code class="language-plaintext highlighter-rouge">{% highlight %}</code> tag, and allows passing the language to highlight in as a parameter.</p>

<p><em>An issue for making this change a part of the mainline Jekyll Highlight tag can be found <a href="https://github.com/jekyll/jekyll/issues/8290">here</a>.</em></p>

<p><em><strong>It appears v0.0.1 did not actually work as intended, and was simply failing gracefully by detecting the language from the code itself. A better job of detecting errors and alerting the user was devised in v0.0.2.</strong></em></p>

<h2 id="installation">Installation</h2>

<p>Add this line to your application’s Gemfile:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">group</span> <span class="ss">:jekyll_plugins</span> <span class="k">do</span>
    <span class="n">gem</span> <span class="s1">'jekyll-highlight-param'</span><span class="p">,</span> <span class="ss">:github</span> <span class="o">=&gt;</span> <span class="s1">'UriShX/jekyll-highlight-param'</span>
<span class="k">end</span>
</code></pre></div></div>

<p>And then execute:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ bundle
</code></pre></div></div>

<p>Or install it yourself as:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ gem install jekyll-highlight-param
</code></pre></div></div>

<p>Then add the following to your site’s <code class="language-plaintext highlighter-rouge">_config.yml</code>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">plugins</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">jekyll-highlight-param</span>
</code></pre></div></div>

<p>💡 If you are using a Jekyll version less than 3.5.0, use the <code class="language-plaintext highlighter-rouge">gems</code> key instead of <code class="language-plaintext highlighter-rouge">plugins</code>.</p>

<h2 id="usage">Usage</h2>

<h3 id="basic-usage">Basic usage</h3>
<p>Basic usage is the same as Jekyll’s <code class="language-plaintext highlighter-rouge">{% highlight %}</code> tag, i.e.:</p>

<div class="language-liquid highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{%</span><span class="w"> </span><span class="nt">highlight_param</span><span class="w"> </span>ruby<span class="w"> </span><span class="p">%}</span>
def foo
  puts 'foo'
end
<span class="p">{%</span><span class="w"> </span><span class="nt">endhighlight_param</span><span class="w"> </span><span class="p">%}</span>
</code></pre></div></div>

<h3 id="using-variables-names-for-the-language">Using variables names for the language</h3>

<p><em>Please note: Since v0.0.2 passing variables to the <code class="language-plaintext highlighter-rouge">highlight_param</code> tag is done in a similar way to the syntax for passing variables to other tags, such as <code class="language-plaintext highlighter-rouge">link</code>. This is a breaking change from v0.0.1.</em></p>

<p>The name of the language you for the code to be highlighted can be specified as a variable instead of specifying the language directly in the template. For example, suppose you defined a variable in your page’s front matter like this:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">title</span><span class="pi">:</span> <span class="s">My page</span>
<span class="na">my_code</span><span class="pi">:</span> <span class="s">footer_company_a.html</span>
<span class="na">my_lang</span><span class="pi">:</span> <span class="s">liquid</span>
<span class="nn">---</span>
</code></pre></div></div>

<p>You could then reference that variable in your highlight:</p>

<div class="language-liquid highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">page</span><span class="p">.</span><span class="nv">my_variable</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="nt">capture</span><span class="w"> </span><span class="nv">my_code</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{%</span><span class="w"> </span><span class="nt">include</span><span class="w"> </span><span class="p">{{</span><span class="w"> </span><span class="nv">page</span><span class="p">.</span><span class="nv">code</span><span class="w"> </span><span class="p">}}</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="nt">endcapture</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="nt">highlight_param</span><span class="w"> </span>{{<span class="w"> </span>page.my_lang<span class="w"> </span>}}<span class="w"> </span><span class="p">%}</span>
    <span class="p">{{</span><span class="w"> </span><span class="nv">my_code</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">strip</span><span class="w"> </span><span class="p">}}</span>
  <span class="p">{%</span><span class="w"> </span><span class="nt">endhighlight_param</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">endif</span><span class="w"> </span><span class="p">%}</span>
</code></pre></div></div>

<p>In this example, the capture will store the include file <code class="language-plaintext highlighter-rouge">_includes/footer_company_a.html</code>, then the highlight will would match the display to match the syntax of <code class="language-plaintext highlighter-rouge">liquid</code>.</p>

<h3 id="line-numbers">Line numbers</h3>

<p>You could also pass a line numbers argument, as in the original <code class="language-plaintext highlighter-rouge">{% highlight %}</code> tag, both as parameter and as a variable. Line numbers are enabled when passing the <code class="language-plaintext highlighter-rouge">linenos</code> argument, and disabled as default.</p>

<div class="language-liquid highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{%</span><span class="w"> </span><span class="nt">highlight_param</span><span class="w"> </span>ruby<span class="w"> </span>linenos<span class="w"> </span><span class="p">%}</span>
def foo
  puts 'foo'
end
<span class="p">{%</span><span class="w"> </span><span class="nt">endhighlight_param</span><span class="w"> </span><span class="p">%}</span>
</code></pre></div></div>
<p>or:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">title</span><span class="pi">:</span> <span class="s">My page</span>
<span class="na">line_numbers</span><span class="pi">:</span> <span class="s">linenos</span>
<span class="nn">---</span>
</code></pre></div></div>

<div class="language-liquid highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{%</span><span class="w"> </span><span class="nt">highlight_param</span><span class="w"> </span>ruby<span class="w"> </span>{{<span class="w"> </span>page.line_numbers<span class="w"> </span>}}<span class="w"> </span><span class="p">%}</span>
def foo
  puts 'foo'
end
<span class="p">{%</span><span class="w"> </span><span class="nt">endhighlight_param</span><span class="w"> </span><span class="p">%}</span>
</code></pre></div></div>

<h2 id="contributing">Contributing</h2>

<ol>
  <li>Fork it.</li>
  <li>Create your feature branch (<code class="language-plaintext highlighter-rouge">git checkout -b my-new-feature</code>)</li>
  <li>Commit your changes (<code class="language-plaintext highlighter-rouge">git commit -am 'Add some feature'</code>)</li>
  <li>Push to the branch (<code class="language-plaintext highlighter-rouge">git push origin my-new-feature</code>)</li>
  <li>Create a new Pull Request</li>
</ol>

                        
                    </div>
                    <footer>
                        <p>
                            
                            <a class="js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                                title="Close this modal">Back</a>
                            
                        </p>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">&times;</a>
            </section>
            
            

            
            
            <section aria-hidden="true" aria-labelledby="modal-label" class="portfolio-modal modal--gallery"
                data-cssmodal-resize="true" id="modal-gallery-24" role="dialog" tabindex="-1">
                <div class="modal-inner">
                    <div class="modal-content">
                        <div class="spinner">
                            <div class="spinner__outer"></div>
                            <div class="spinner__inner"></div>
                        </div>


                        <div aria-atomic="false" aria-live="polite" class="modal-detail"></div>

                        <ul class="modal--gallery-navigation">
                            <li>
                                <a class="modal--gallery-navigation-prev" href="#" title="Previous">Previous</a>
                            </li>
                            <li>
                                <a class="modal--gallery-navigation-next" href="#" title="Next">Next</a>
                            </li>
                        </ul>

                    </div>
                    <div class="modal--gallery-caption"></div>

                    <footer>
                        <ul aria-hidden="true" class="modal-content-list is-active">
                            
                            
                            <li data-caption="">
                                
                            </li>
                            
                            
                            
                            <li data-caption="">
                                
                                <a href="#stackable-24-2">
                                    <img alt=""
                                        data-src-fullsize="/assets/img/portfolio/twotone_description_black_48pt_3x.png">
                                </a>
                                
                            </li>
                            
                            
                            
                        </ul>
                    </footer>
                </div>

                <a class="modal-close js-modal-close" data-close="Close" data-dismiss="modal" href="#!"
                    title="Close this modal">?</a>
            </section>
            
        </div>
        
    </div>

</div>

<script>
    /***
     * Truncate excerpt paragraph if too long for current width, and trim white spaces.
     */
    (function () {
        var blocks = document.querySelectorAll('.portfolio-excerpt');

        for (var block of blocks) {
            var pHeight = block.offsetHeight - block.querySelector('h3').offsetHeight;
            var paragraph = block.querySelector('p');
            var pText = paragraph.textContent;
            pText = pText.trim();
            var pFontSize = window.getComputedStyle(paragraph, null).getPropertyValue('font-size');
            pFontSize = parseInt(pFontSize.split('px')[0], 10);

            var n = parseInt(paragraph.offsetWidth / pFontSize) * parseInt(pHeight / pFontSize);

            paragraph.innerHTML = (pText.length > n) ? pText.substr(0, n - 1) + '&hellip;' : pText;
        }

    })();
</script>

<script>
    function handleResize() {
        if (window.innerWidth <= 640) {
            document.querySelectorAll('.portfolio-modal').forEach((_) => {
                _.setAttribute('data-cssmodal-resize', 'false');
            })
        } else {
            document.querySelectorAll('.portfolio-modal').forEach((_) => {
                _.setAttribute('data-cssmodal-resize', 'true');
            })
        }
    }

    window.addEventListener("resize", handleResize);
    window.addEventListener("load", handleResize);
</script>

<script src="/assets/script/portfolio-tag-filter.js"></script>
<script src="/assets/script/modal.js"></script>
<script src="/assets/script/modal-gallery.js"></script>
<script src="/assets/script/modal-helper.js"></script>
<script src="/assets/script/modal-maxwidth.js"></script>
<script src="/assets/script/modal-resize.js"></script>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">&#169; Uri Shani 2020</li>
          <li><a class="u-email" href="mailto:urish@urishx.com">urish@urishx.com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>A portfolio centered site with a blog, to feature my adventures and projects in  making, programming, and engineering. Built in Jekyll, to be served from Github pages.
</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://hackaday.io/UriSh" title="UriSh"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#hackaday"></use></svg></a></li><li><a rel="me" href="https://www.facebook.com/uri.sh.982" title="uri.sh.982"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#facebook"></use></svg></a></li><li><a rel="me" href="https://github.com/UriShX" title="UriShX"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://www.linkedin.com/in/urishx" title="urishx"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg></a></li><li><a rel="me" href="https://twitter.com/UriShX" title="UriShX"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
